Using config: configs/x16_base_config.json
Running GEMM tests...
Test 1: M=1024, K=12288, N=12288
compute module:
simdram config: 8channels x 32ranks x 16banks x 16arrays x 1subarrays x 16384subarr_rows x 1024cols x 8devices, with_PE: True
simdram bw: 13107.2GB/s
simdram internal bw: 4739326.553672316GB/s
simdram ops: 2368.7223119347013Tops
memory capacity: 1024.0GB
peripheral area: 2113.579418320765mm^2
dram area: 33792.0mm^2

memory module: N/A
io module: N/A
Running mapping search...
find_simdram_mapping: Best mapping: Strategy(
  Loop Order: mkn  PE Enabled: True  Broadcast: AB
  Array Multicast: False
  Column Popcount: True
  Tile Mapping:  M: RB  N: CA  K: DS  Array Mapping:  R: N  C: MK
  Weight Resident: True
  Input Resident: False
  Output Resident: False
)
Running simulation...
--- Input Matmul Size --- M:1024, K:12288, N:12288
Maximum Array Tile Size: {'M': 2, 'K': 1536, 'N': 96}
get_arr_tile_stats: arr_latency=42163.2000001952, capacity_utilization=0.046875
get_tile_stats: K_reduction_latency: 3.84e-06 = 50331648.0 / 13107200000000.0
RB DS ['C', 'A'] {'C': 1, 'R': 1, 'B': 1, 'A': 1, 'S': 1, 'D': 1}
2097152.0 = 1024 * 4096 * 0.5
get_tile_io_latency: data_volume=16777216.0, dup=['A'], simd_utilization={'C': 1, 'R': 1, 'B': 1, 'A': 1, 'S': 1, 'D': 1}
get_tile_io_latency: latency=1.28e-06 = 16777216.0 / 13107200000000.0
get_tile_stats: tile_size: {'M': 1024, 'K': 4096, 'N': 12288}, arr_tile_size: {'M': 2, 'K': 512, 'N': 96}, MK_dup: 1, KN_dup:2, MN_dup:512, M_K_io_latency: 1.28e-06, K_N_io_latency: 0, M_N_io_latency: 4.8e-07, tile_compute_latency:42163.2000040352 = 42163.2000001952(arr_latency) + 3.84e-06(K_reduction_latency)
================ Strategy Summary ================
Strategy(
  Loop Order: mkn  PE Enabled: True  Broadcast: AB
  Array Multicast: False
  Column Popcount: True
  Tile Mapping:  M: RB  N: CA  K: DS  Array Mapping:  R: N  C: MK
  Weight Resident: True
  Input Resident: False
  Output Resident: False
)

---------------- Tile Sizes ----------------------
| Tile_M      | Tile_N      | Tile_K      |
|-------------|-------------|-------------|
| 1024        | 12288       | 4096        |

| Arr_Tile_M  | Arr_Tile_N  | Arr_Tile_K  |
|-------------|-------------|-------------|
| 2           | 96          | 512         |

--------------- Utilization ----------------------
| Row         | Col         | Array       | Bank        | Device      | Rank        | Channel     |
|-------------|-------------|-------------|-------------|-------------|-------------|-------------|
| 0.046875    | 1.0         | 1           | 1           | 1           | 1           | 1           |

------------------ Latency -----------------------
| Total Latency        | 126489.6000169056      cycles|
| Total Compute Latency | 126489.6000121056      cycles|
| Total Array Latency  | 126489.60000058559     cycles|
| Total Reduction Latency| 1.1519999999999998e-05 cycles|
| IO Latency           | 4.8e-06                cycles|

----------- Hardware Requirements ---------------
| col_multicast        | False                 |
| col_broadcast        | False                 |
| broadcast            | {'C': True, 'R': False, 'B': False, 'A': True, 'S': False, 'D': False}|
| reduction            | {'C': False, 'R': False, 'B': False, 'A': False, 'S': True, 'D': True}|
==================================================

---------------- Debug Info -----------------------
| Remaining Tiles       |                         |
|-----------------------|-------------------------|
| M_remain              | 0                      |
| N_remain              | 0                      |
| K_remain              | 0                      |

| Fully Partitioned #Tiles |                       |
|-------------------------|-----------------------|
| M_t                   | 1                      |
| N_t                   | 1                      |
| K_t                   | 3                      |

|------------------------|------------------------|
==================================================
Tiling utilization: {'C': 1, 'R': 1, 'B': 1, 'A': 1, 'S': 1, 'D': 1}
Column utilization: 1.0
Capacity utilization: 0.046875
GEMM 1024x12288x12288 latency: 126489.6000169056s
simulated latency: GEMM_1024x12288x12288 126489.6000169056
roofline_model_simdram: total_ops=309237645312, total_data_movement=12582912.0, peak_flops=2368722311934701.0, bandwidth=13107200000000.0
roofline_model_simdram: compute_bound_time=0.0001305504, memory_bound_time=9.6e-07
GEMM roofline latency: 0.0001305504ms
Results written to test_gemm_x16_base_config.json_1024_12288_12288_simdram_ddr5_operandocality.csv
Test 2: M=2048, K=24576, N=24576
compute module:
simdram config: 8channels x 32ranks x 16banks x 16arrays x 1subarrays x 16384subarr_rows x 1024cols x 8devices, with_PE: True
simdram bw: 13107.2GB/s
simdram internal bw: 4739326.553672316GB/s
simdram ops: 2368.7223119347013Tops
memory capacity: 1024.0GB
peripheral area: 2113.579418320765mm^2
dram area: 33792.0mm^2

memory module: N/A
io module: N/A
Running mapping search...
find_simdram_mapping: Best mapping: Strategy(
  Loop Order: mkn  PE Enabled: True  Broadcast: AB
  Array Multicast: False
  Column Popcount: True
  Tile Mapping:  M: RB  N: CA  K: DS  Array Mapping:  R: MN  C: K
  Weight Resident: True
  Input Resident: False
  Output Resident: False
)
Running simulation...
--- Input Matmul Size --- M:2048, K:24576, N:24576
Maximum Array Tile Size: {'M': 4, 'K': 3072, 'N': 192}
get_arr_tile_stats: arr_latency=337305.6000001952, capacity_utilization=0.1875
get_tile_stats: K_reduction_latency: 1.536e-05 = 201326592.0 / 13107200000000.0
RB DS ['C', 'A'] {'C': 1, 'R': 1, 'B': 1, 'A': 1, 'S': 1, 'D': 1}
8388608.0 = 2048 * 8192 * 0.5
get_tile_io_latency: data_volume=67108864.0, dup=['A'], simd_utilization={'C': 1, 'R': 1, 'B': 1, 'A': 1, 'S': 1, 'D': 1}
get_tile_io_latency: latency=5.12e-06 = 67108864.0 / 13107200000000.0
get_tile_stats: tile_size: {'M': 2048, 'K': 8192, 'N': 24576}, arr_tile_size: {'M': 4, 'K': 1024, 'N': 192}, MK_dup: 1, KN_dup:1, MN_dup:1024, M_K_io_latency: 5.12e-06, K_N_io_latency: 0, M_N_io_latency: 1.92e-06, tile_compute_latency:337305.6000155552 = 337305.6000001952(arr_latency) + 1.536e-05(K_reduction_latency)
================ Strategy Summary ================
Strategy(
  Loop Order: mkn  PE Enabled: True  Broadcast: AB
  Array Multicast: False
  Column Popcount: True
  Tile Mapping:  M: RB  N: CA  K: DS  Array Mapping:  R: MN  C: K
  Weight Resident: True
  Input Resident: False
  Output Resident: False
)

---------------- Tile Sizes ----------------------
| Tile_M      | Tile_N      | Tile_K      |
|-------------|-------------|-------------|
| 2048        | 24576       | 8192        |

| Arr_Tile_M  | Arr_Tile_N  | Arr_Tile_K  |
|-------------|-------------|-------------|
| 4           | 192         | 1024        |

--------------- Utilization ----------------------
| Row         | Col         | Array       | Bank        | Device      | Rank        | Channel     |
|-------------|-------------|-------------|-------------|-------------|-------------|-------------|
| 0.1875      | 1.0         | 1           | 1           | 1           | 1           | 1           |

------------------ Latency -----------------------
| Total Latency        | 1011916.8000658656     cycles|
| Total Compute Latency | 1011916.8000466656     cycles|
| Total Array Latency  | 1011916.8000005856     cycles|
| Total Reduction Latency| 4.607999999999999e-05  cycles|
| IO Latency           | 1.92e-05               cycles|

----------- Hardware Requirements ---------------
| col_multicast        | False                 |
| col_broadcast        | False                 |
| broadcast            | {'C': True, 'R': False, 'B': False, 'A': True, 'S': False, 'D': False}|
| reduction            | {'C': False, 'R': False, 'B': False, 'A': False, 'S': True, 'D': True}|
==================================================

---------------- Debug Info -----------------------
| Remaining Tiles       |                         |
|-----------------------|-------------------------|
| M_remain              | 0                      |
| N_remain              | 0                      |
| K_remain              | 0                      |

| Fully Partitioned #Tiles |                       |
|-------------------------|-----------------------|
| M_t                   | 1                      |
| N_t                   | 1                      |
| K_t                   | 3                      |

|------------------------|------------------------|
==================================================
Tiling utilization: {'C': 1, 'R': 1, 'B': 1, 'A': 1, 'S': 1, 'D': 1}
Column utilization: 1.0
Capacity utilization: 0.1875
GEMM 2048x24576x24576 latency: 1011916.8000658656s
simulated latency: GEMM_2048x24576x24576 1011916.8000658656
roofline_model_simdram: total_ops=2473901162496, total_data_movement=50331648.0, peak_flops=2368722311934701.0, bandwidth=13107200000000.0
roofline_model_simdram: compute_bound_time=0.0010444032, memory_bound_time=3.84e-06
GEMM roofline latency: 0.0010444032ms
Results written to test_gemm_x16_base_config.json_2048_24576_24576_simdram_ddr5_operandocality.csv
Test 3: M=1, K=12288, N=12288
compute module:
simdram config: 8channels x 32ranks x 16banks x 16arrays x 1subarrays x 16384subarr_rows x 1024cols x 8devices, with_PE: True
simdram bw: 13107.2GB/s
simdram internal bw: 4739326.553672316GB/s
simdram ops: 2368.7223119347013Tops
memory capacity: 1024.0GB
peripheral area: 2113.579418320765mm^2
dram area: 33792.0mm^2

memory module: N/A
io module: N/A
Running mapping search...
find_simdram_mapping: Best mapping: Strategy(
  Loop Order: mkn  PE Enabled: True  Broadcast: AB
  Array Multicast: False
  Column Popcount: True
  Tile Mapping:  M:   N: CRA  K: BDS  Array Mapping:  R: M  C: KN
  Weight Resident: True
  Input Resident: False
  Output Resident: False
)
Running simulation...
--- Input Matmul Size --- M:1, K:12288, N:12288
Maximum Array Tile Size: {'M': 1, 'K': 96, 'N': 3}
find_arr_tile: 3 = min(3, 32)
get_arr_tile_stats: arr_latency=439.2000001952, capacity_utilization=0.00048828125
get_tile_stats: K_reduction_latency: 6e-08 = 786432.0 / 13107200000000.0
 BDS ['C', 'R', 'A'] {'C': 1, 'R': 1, 'B': 1, 'A': 1, 'S': 1, 'D': 1}
6144.0 = 1 * 12288 * 0.5
get_tile_io_latency: data_volume=1572864.0, dup=['A'], simd_utilization={'C': 1, 'R': 1, 'B': 1, 'A': 1, 'S': 1, 'D': 1}
get_tile_io_latency: latency=1.2e-07 = 1572864.0 / 13107200000000.0
get_tile_stats: tile_size: {'M': 1, 'K': 12288, 'N': 12288}, arr_tile_size: {'M': 1, 'K': 96, 'N': 3}, MK_dup: 3, KN_dup:1, MN_dup:96, M_K_io_latency: 3.5999999999999994e-07, K_N_io_latency: 0, M_N_io_latency: 4.6875e-10, tile_compute_latency:439.2000002552 = 439.2000001952(arr_latency) + 6e-08(K_reduction_latency)
================ Strategy Summary ================
Strategy(
  Loop Order: mkn  PE Enabled: True  Broadcast: AB
  Array Multicast: False
  Column Popcount: True
  Tile Mapping:  M:   N: CRA  K: BDS  Array Mapping:  R: M  C: KN
  Weight Resident: True
  Input Resident: False
  Output Resident: False
)

---------------- Tile Sizes ----------------------
| Tile_M      | Tile_N      | Tile_K      |
|-------------|-------------|-------------|
| 1           | 12288       | 12288       |

| Arr_Tile_M  | Arr_Tile_N  | Arr_Tile_K  |
|-------------|-------------|-------------|
| 1           | 3           | 96          |

--------------- Utilization ----------------------
| Row         | Col         | Array       | Bank        | Device      | Rank        | Channel     |
|-------------|-------------|-------------|-------------|-------------|-------------|-------------|
| 0.00048828125 | 0.28125     | 1           | 1           | 1           | 1           | 1           |

------------------ Latency -----------------------
| Total Latency        | 439.20000061613746     cycles|
| Total Compute Latency | 439.2000002552         cycles|
| Total Array Latency  | 439.2000001952         cycles|
| Total Reduction Latency| 6e-08                  cycles|
| IO Latency           | 3.609375e-07           cycles|

----------- Hardware Requirements ---------------
| col_multicast        | True                  |
| col_broadcast        | False                 |
| broadcast            | {'C': True, 'R': True, 'B': False, 'A': True, 'S': False, 'D': False}|
| reduction            | {'C': False, 'R': False, 'B': True, 'A': False, 'S': True, 'D': True}|
==================================================

---------------- Debug Info -----------------------
| Remaining Tiles       |                         |
|-----------------------|-------------------------|
| M_remain              | 0                      |
| N_remain              | 0                      |
| K_remain              | 0                      |

| Fully Partitioned #Tiles |                       |
|-------------------------|-----------------------|
| M_t                   | 1                      |
| N_t                   | 1                      |
| K_t                   | 1                      |

|------------------------|------------------------|
==================================================
Tiling utilization: {'C': 1, 'R': 1, 'B': 1, 'A': 1, 'S': 1, 'D': 1}
Column utilization: 0.28125
Capacity utilization: 0.00048828125
GEMM 1x12288x12288 latency: 439.20000061613746s
simulated latency: GEMM_1x12288x12288 439.20000061613746
roofline_model_simdram: total_ops=301989888, total_data_movement=12288.0, peak_flops=2368722311934701.0, bandwidth=13107200000000.0
roofline_model_simdram: compute_bound_time=1.27490625e-07, memory_bound_time=9.375e-10
GEMM roofline latency: 1.27490625e-07ms
Results written to test_gemm_x16_base_config.json_1_12288_12288_simdram_ddr5_operandocality.csv
Test 4: M=1, K=24576, N=24576
compute module:
simdram config: 8channels x 32ranks x 16banks x 16arrays x 1subarrays x 16384subarr_rows x 1024cols x 8devices, with_PE: True
simdram bw: 13107.2GB/s
simdram internal bw: 4739326.553672316GB/s
simdram ops: 2368.7223119347013Tops
memory capacity: 1024.0GB
peripheral area: 2113.579418320765mm^2
dram area: 33792.0mm^2

memory module: N/A
io module: N/A
Running mapping search...
find_simdram_mapping: Best mapping: Strategy(
  Loop Order: mkn  PE Enabled: True  Broadcast: AB
  Array Multicast: False
  Column Popcount: True
  Tile Mapping:  M:   N: CBAD  K: RS  Array Mapping:  R: MN  C: K
  Weight Resident: True
  Input Resident: False
  Output Resident: False
)
Running simulation...
--- Input Matmul Size --- M:1, K:24576, N:24576
Maximum Array Tile Size: {'M': 1, 'K': 768, 'N': 2}
get_arr_tile_stats: arr_latency=878.4000001951999, capacity_utilization=0.00048828125
get_tile_stats: K_reduction_latency: 3e-08 = 393216.0 / 13107200000000.0
 RS ['C', 'B', 'A', 'D'] {'C': 1, 'R': 1, 'B': 1, 'A': 1, 'S': 1, 'D': 1}
12288.0 = 1 * 24576 * 0.5
get_tile_io_latency: data_volume=786432.0, dup=['B', 'A'], simd_utilization={'C': 1, 'R': 1, 'B': 1, 'A': 1, 'S': 1, 'D': 1}
get_tile_io_latency: latency=9.6e-07 = 786432.0 / 819200000000.0
get_tile_stats: tile_size: {'M': 1, 'K': 24576, 'N': 24576}, arr_tile_size: {'M': 1, 'K': 768, 'N': 2}, MK_dup: 1, KN_dup:1, MN_dup:768, M_K_io_latency: 9.6e-07, K_N_io_latency: 0, M_N_io_latency: 9.375e-10, tile_compute_latency:878.4000002252 = 878.4000001951999(arr_latency) + 3e-08(K_reduction_latency)
================ Strategy Summary ================
Strategy(
  Loop Order: mkn  PE Enabled: True  Broadcast: AB
  Array Multicast: False
  Column Popcount: True
  Tile Mapping:  M:   N: CBAD  K: RS  Array Mapping:  R: MN  C: K
  Weight Resident: True
  Input Resident: False
  Output Resident: False
)

---------------- Tile Sizes ----------------------
| Tile_M      | Tile_N      | Tile_K      |
|-------------|-------------|-------------|
| 1           | 24576       | 24576       |

| Arr_Tile_M  | Arr_Tile_N  | Arr_Tile_K  |
|-------------|-------------|-------------|
| 1           | 2           | 768         |

--------------- Utilization ----------------------
| Row         | Col         | Array       | Bank        | Device      | Rank        | Channel     |
|-------------|-------------|-------------|-------------|-------------|-------------|-------------|
| 0.00048828125 | 0.75        | 1           | 1           | 1           | 1           | 1           |

------------------ Latency -----------------------
| Total Latency        | 878.400001187075       cycles|
| Total Compute Latency | 878.4000002252         cycles|
| Total Array Latency  | 878.4000001951999      cycles|
| Total Reduction Latency| 3e-08                  cycles|
| IO Latency           | 9.618749999999998e-07  cycles|

----------- Hardware Requirements ---------------
| col_multicast        | False                 |
| col_broadcast        | False                 |
| broadcast            | {'C': True, 'R': False, 'B': True, 'A': True, 'S': False, 'D': True}|
| reduction            | {'C': False, 'R': True, 'B': False, 'A': False, 'S': True, 'D': False}|
==================================================

---------------- Debug Info -----------------------
| Remaining Tiles       |                         |
|-----------------------|-------------------------|
| M_remain              | 0                      |
| N_remain              | 0                      |
| K_remain              | 0                      |

| Fully Partitioned #Tiles |                       |
|-------------------------|-----------------------|
| M_t                   | 1                      |
| N_t                   | 1                      |
| K_t                   | 1                      |

|------------------------|------------------------|
==================================================
Tiling utilization: {'C': 1, 'R': 1, 'B': 1, 'A': 1, 'S': 1, 'D': 1}
Column utilization: 0.75
Capacity utilization: 0.00048828125
GEMM 1x24576x24576 latency: 878.400001187075s
simulated latency: GEMM_1x24576x24576 878.400001187075
roofline_model_simdram: total_ops=1207959552, total_data_movement=24576.0, peak_flops=2368722311934701.0, bandwidth=13107200000000.0
roofline_model_simdram: compute_bound_time=5.099625e-07, memory_bound_time=1.875e-09
GEMM roofline latency: 5.099625e-07ms
Results written to test_gemm_x16_base_config.json_1_24576_24576_simdram_ddr5_operandocality.csv
Running LLM tests...
Testing GPT-3 175B model prefill
Simulate Running on DRAM PIM
compute module:
simdram config: 8channels x 32ranks x 16banks x 16arrays x 1subarrays x 16384subarr_rows x 1024cols x 8devices, with_PE: True
simdram bw: 13107.2GB/s
simdram internal bw: 4739326.553672316GB/s
simdram ops: 2368.7223119347013Tops
memory capacity: 1024.0GB
peripheral area: 2113.579418320765mm^2
dram area: 33792.0mm^2

memory module: N/A
io module: N/A
LLM model: gpt3-175B
simulating qkv: Matmul M=1024, K=12288, N=12288
qkv latency: 379468.8001137168, compute latency: 126489.6000121056, io overhead: 4.8e-06
simulating q_mul_k: Batched Matmul BS=96 M=1024, K=128, N=1024
Batched Matmul: M=1024, K=128, N=1024, BS=96
BatchedMatmul latency: 42163.200060979194
q_mul_k latency: 42163.200081979194, compute latency: 42163.2000225792, io overhead: 3.84e-05
simulating a_mul_v: Batched Matmul BS=96 M=1024, K=1024, N=128
Batched Matmul: M=1024, K=1024, N=128, BS=96
BatchedMatmul latency: 42163.2000542592
a_mul_v latency: 42163.2000752592, compute latency: 42163.2000225792, io overhead: 3.168e-05
simulating h_matmul0: Matmul M=1024, K=12288, N=12288
h_matmul0 latency: 126489.6000379056, compute latency: 126489.6000121056, io overhead: 4.8e-06
simulating h1_matmul1: Matmul M=1024, K=12288, N=49152
h1_matmul1 latency: 505958.4000655824, compute latency: 505958.40002538246, io overhead: 1.9199999999999996e-05
simulating h2_matmul2: Matmul M=1024, K=49152, N=12288
h2_matmul2 latency: 505958.4000609456, compute latency: 505958.4000236256, io overhead: 1.6319999999999996e-05
finish matmul simulation
matmul total overhead: 0.000168
matmul total latency w/o overhead: 1602201.6002673889
matmul total latency: 1602201.600435389
weighted avg simd utilization: 0.9605263157265961
weighted avg tiling utilization: {'C': 1.0, 'R': 1.0, 'B': 1.0, 'A': 1.0, 'S': 1.0, 'D': 1.0}
gpt3-175B 96 layers prefill latency: 153811353.65590936
simulated latency: gpt3-175B_prefill 153811353.65590936
Testing GPT-3 175B model decode
Simulate Running on DRAM PIM
compute module:
simdram config: 8channels x 32ranks x 16banks x 16arrays x 1subarrays x 16384subarr_rows x 1024cols x 8devices, with_PE: True
simdram bw: 13107.2GB/s
simdram internal bw: 4739326.553672316GB/s
simdram ops: 2368.7223119347013Tops
memory capacity: 1024.0GB
peripheral area: 2113.579418320765mm^2
dram area: 33792.0mm^2

memory module: N/A
io module: N/A
simulating qkv: Matmul M=1, K=12288, N=12288
qkv latency: 1317.6000648484123, compute latency: 1317.6000007656, io overhead: 1.0828125e-06, kernel launch overhead: 6.3e-05
simulating q_mul_k:BatchedMatmul BS=96 M=1, K=128, N=1025
Batched Matmul: M=1, K=128, N=1025, BS=96
BatchedMatmul latency: 42163.20001922694
q_mul_k latency: 42163.20004022694, compute latency: 42163.200018979434, io overhead: 2.4750732421874997e-07, kernel launch overhead: 2.1e-05
simulating a_mul_v: BatchedMatmul BS=96 M=1, K=1025, N=128
Batched Matmul: M=1, K=1025, N=128, BS=96
BatchedMatmul latency: 42163.20001934026
a_mul_v latency: 42163.200040340256, compute latency: 42163.2000192192, io overhead: 1.210546875e-07, kernel launch overhead: 2.1e-05
simulating h_matmul0: Matmul M=1, K=12288, N=12288
h_matmul0 latency: 439.20002161613746, compute latency: 439.2000002552, io overhead: 3.609375e-07, kernel launch overhead: 2.1e-05
simulating h1_matmul1: Matmul M=1, K=12288, N=49152
h1_matmul1 latency: 878.40002218895, compute latency: 878.4000002252, io overhead: 9.6375e-07, kernel launch overhead: 2.1e-05
simulating h2_matmul2: Matmul M=1, K=49152, N=12288
h2_matmul2 latency: 878.4000221861373, compute latency: 878.4000002252, io overhead: 9.609374999999999e-07, kernel launch overhead: 2.1e-05
finish matmul simulation
matmul total overhead: 0.000168
matmul total latency w/o overhead: 87840.00004340682
matmul total latency: 87840.00021140682
weighted avg simd utilization: 0.022500000603371748
weighted avg tiling utilization: {'C': 1.0, 'R': 1.0, 'B': 1.0, 'A': 0.25000000108851944, 'S': 1.0, 'D': 1.0}
gpt3-175B decode latency per token: 87840.00035840682
gpt3-175B decode total latency for 2048 tokens: 188241120.7680658
simulated latency: gpt3-175B_decode 188241120.7680658
Testing GPT-3 6.7B model prefill
Simulate Running on DRAM PIM
compute module:
simdram config: 8channels x 32ranks x 16banks x 16arrays x 1subarrays x 16384subarr_rows x 1024cols x 8devices, with_PE: True
simdram bw: 13107.2GB/s
simdram internal bw: 4739326.553672316GB/s
simdram ops: 2368.7223119347013Tops
memory capacity: 1024.0GB
peripheral area: 2113.579418320765mm^2
dram area: 33792.0mm^2

memory module: N/A
io module: N/A
LLM model: gpt3-6.7B
simulating qkv: Matmul M=1024, K=4096, N=4096
qkv latency: 42163.20007222559, compute latency: 14054.400001475198, io overhead: 1.6e-06
simulating q_mul_k: Batched Matmul BS=32 M=1024, K=128, N=1024
Batched Matmul: M=1024, K=128, N=1024, BS=32
BatchedMatmul latency: 14054.400020326399
q_mul_k latency: 14054.400041326398, compute latency: 14054.4000075264, io overhead: 1.28e-05
simulating a_mul_v: Batched Matmul BS=32 M=1024, K=1024, N=128
Batched Matmul: M=1024, K=1024, N=128, BS=32
BatchedMatmul latency: 14054.400018086399
a_mul_v latency: 14054.400039086398, compute latency: 14054.4000075264, io overhead: 1.056e-05
simulating h_matmul0: Matmul M=1024, K=4096, N=4096
h_matmul0 latency: 14054.400024075198, compute latency: 14054.400001475198, io overhead: 1.6e-06
simulating h1_matmul1: Matmul M=1024, K=4096, N=16384
h1_matmul1 latency: 56217.6000288752, compute latency: 56217.600005315195, io overhead: 2.56e-06
simulating h2_matmul2: Matmul M=1024, K=16384, N=4096
h2_matmul2 latency: 56217.6000291952, compute latency: 56217.6000027552, io overhead: 5.4400000000000004e-06
finish matmul simulation
matmul total overhead: 0.000168
matmul total latency w/o overhead: 196761.60006678395
matmul total latency: 196761.60023478395
weighted avg simd utilization: 0.8928571426784792
weighted avg tiling utilization: {'C': 1.0, 'R': 1.0, 'B': 1.0, 'A': 1.0, 'S': 1.0, 'D': 1.0}
gpt3-6.7B 32 layers prefill latency: 6296371.212217086
simulated latency: gpt3-6.7B_prefill 6296371.212217086
Testing GPT-3 6.7B model decode
Simulate Running on DRAM PIM
compute module:
simdram config: 8channels x 32ranks x 16banks x 16arrays x 1subarrays x 16384subarr_rows x 1024cols x 8devices, with_PE: True
simdram bw: 13107.2GB/s
simdram internal bw: 4739326.553672316GB/s
simdram ops: 2368.7223119347013Tops
memory capacity: 1024.0GB
peripheral area: 2113.579418320765mm^2
dram area: 33792.0mm^2

memory module: N/A
io module: N/A
simulating qkv: Matmul M=1, K=4096, N=4096
qkv latency: 1317.6000637665375, compute latency: 1317.6000006456002, io overhead: 1.209375e-07, kernel launch overhead: 6.3e-05
simulating q_mul_k:BatchedMatmul BS=32 M=1, K=128, N=1025
Batched Matmul: M=1, K=128, N=1025, BS=32
BatchedMatmul latency: 14054.40000640898
q_mul_k latency: 14054.40002740898, compute latency: 14054.400006326478, io overhead: 8.250244140624999e-08, kernel launch overhead: 2.1e-05
simulating a_mul_v: BatchedMatmul BS=32 M=1, K=1025, N=128
Batched Matmul: M=1, K=1025, N=128, BS=32
BatchedMatmul latency: 14054.400006446753
a_mul_v latency: 14054.400027446753, compute latency: 14054.4000064064, io overhead: 4.03515625e-08, kernel launch overhead: 2.1e-05
simulating h_matmul0: Matmul M=1, K=4096, N=4096
h_matmul0 latency: 439.2000212555125, compute latency: 439.2000002152, io overhead: 4.03125e-08, kernel launch overhead: 2.1e-05
simulating h1_matmul1: Matmul M=1, K=4096, N=16384
h1_matmul1 latency: 439.20002137645, compute latency: 439.2000002152, io overhead: 1.6125e-07, kernel launch overhead: 2.1e-05
simulating h2_matmul2: Matmul M=1, K=16384, N=4096
h2_matmul2 latency: 439.20002137551256, compute latency: 439.2000002152, io overhead: 1.603125e-07, kernel launch overhead: 2.1e-05
finish matmul simulation
matmul total overhead: 0.000168
matmul total latency w/o overhead: 30744.000014629746
matmul total latency: 30744.000182629745
weighted avg simd utilization: 0.0071428573641548355
weighted avg tiling utilization: {'C': 1.0, 'R': 1.0, 'B': 1.0, 'A': 0.2857142885634581, 'S': 1.0, 'D': 1.0}
gpt3-6.7B decode latency per token: 30744.000329629747
gpt3-6.7B decode total latency for 2048 tokens: 63916776.685300246
simulated latency: gpt3-6.7B_decode 63916776.685300246
Testing LLaMA 3.1 70B model prefill
Simulate Running on DRAM PIM
compute module:
simdram config: 8channels x 32ranks x 16banks x 16arrays x 1subarrays x 16384subarr_rows x 1024cols x 8devices, with_PE: True
simdram bw: 13107.2GB/s
simdram internal bw: 4739326.553672316GB/s
simdram ops: 2368.7223119347013Tops
memory capacity: 1024.0GB
peripheral area: 2113.579418320765mm^2
dram area: 33792.0mm^2

memory module: N/A
io module: N/A
LLM model: Llama-3.1-70B
simulating q_proj: Matmul M=1024, K=8192, N=8192
q_proj latency: 56217.600026955195, compute latency: 56217.6000027552, io overhead: 3.2e-06
simulating k_proj: Matmul M=1024, K=8192, N=1024
k_proj latency: 7027.2000241552, compute latency: 7027.2000005152, io overhead: 2.64e-06
simulating v_proj: Matmul M=1024, K=8192, N=1024
skipping v_proj simulation, using k_proj
v_proj latency: 7027.2000241552, compute latency: 7027.2000005152, io overhead: 2.64e-06
simulating q_mul_k: Batched_Matmul BS=64 M=1024, K=128, N=1024
Batched Matmul: M=1024, K=128, N=1024, BS=64
BatchedMatmul latency: 28108.800040652797
q_mul_k latency: 28108.800061652797, compute latency: 28108.8000150528, io overhead: 2.56e-05
simulating a_mul_v: Batched_Matmul BS=64 M=1024, K=1024, N=128
Batched Matmul: M=1024, K=1024, N=128, BS=64
BatchedMatmul latency: 28108.800036172797
a_mul_v latency: 28108.800057172797, compute latency: 28108.8000150528, io overhead: 2.112e-05
simulating h_matmul0: Matmul M=1024, K=8192, N=8192
h_matmul0 latency: 56217.600026955195, compute latency: 56217.6000027552, io overhead: 3.2e-06
simulating h1_matmul1: Matmul M=1024, K=8192, N=28672
h1_matmul1 latency: 196761.6000349552, compute latency: 196761.60000915517, io overhead: 4.800000000000001e-06
simulating h2_matmul2: Matmul M=1024, K=28672, N=8192
h2_matmul2 latency: 196761.60004988642, compute latency: 196761.60001928636, io overhead: 9.6e-06
finish matmul simulation
matmul total overhead: 0.000168
matmul total latency w/o overhead: 576230.4001378879
matmul total latency: 576230.4003058879
weighted avg simd utilization: 0.9268292681768663
weighted avg tiling utilization: {'C': 1.0, 'R': 1.0, 'B': 1.0, 'A': 1.0, 'S': 1.0, 'D': 1.0}
Llama-3.1-70B 80 layers prefill latency: 46098432.036231026
simulated latency: Llama-3.1-70B_prefill 46098432.036231026
Testing LLaMA 3.1 70B model decode
Simulate Running on DRAM PIM
compute module:
simdram config: 8channels x 32ranks x 16banks x 16arrays x 1subarrays x 16384subarr_rows x 1024cols x 8devices, with_PE: True
simdram bw: 13107.2GB/s
simdram internal bw: 4739326.553672316GB/s
simdram ops: 2368.7223119347013Tops
memory capacity: 1024.0GB
peripheral area: 2113.579418320765mm^2
dram area: 33792.0mm^2

memory module: N/A
io module: N/A
simulating q_proj: Matmul M=1, K=8192, N=8192
q_proj latency: 439.20002137582503, compute latency: 439.2000002152, io overhead: 1.60625e-07
simulating k_proj: Matmul M=1, K=8192, N=1024
k_proj latency: 439.20002123527814, compute latency: 439.2000002152, io overhead: 2.0078125e-08
simulating v_proj: Matmul M=1, K=8192, N=1024
skipping v_proj simulation, using k_proj
v_proj latency: 439.20002123527814, compute latency: 439.2000002152, io overhead: 2.0078125e-08
simulating q_mul_k: Batched_Matmul BS=64 M=1, K=128, N=1025
Batched Matmul: M=1, K=128, N=1025, BS=64
BatchedMatmul latency: 28108.80001281796
q_mul_k latency: 28108.80003381796, compute latency: 28108.800012652955, io overhead: 1.6500488281249998e-07
simulating a_mul_v: Batched_Matmul BS=64 M=1, K=1025, N=128
Batched Matmul: M=1, K=1025, N=128, BS=64
BatchedMatmul latency: 28108.800012893505
a_mul_v latency: 28108.800033893505, compute latency: 28108.8000128128, io overhead: 8.0703125e-08
simulating h_matmul0: Matmul M=1, K=8192, N=8192
h_matmul0 latency: 439.20002137582503, compute latency: 439.2000002152, io overhead: 1.60625e-07
simulating h1_matmul1: Matmul M=1, K=8192, N=28672
h1_matmul1 latency: 439.2000218577, compute latency: 439.2000002152, io overhead: 6.425e-07
simulating h2_matmul2: Matmul M=1, K=28672, N=8192
h2_matmul2 latency: 439.20002177582506, compute latency: 439.2000002152, io overhead: 5.606250000000001e-07
finish matmul simulation
matmul total overhead: 0.000168
matmul total latency w/o overhead: 58852.800028567195
matmul total latency: 58852.800196567194
weighted avg simd utilization: 0.010960821310813475
weighted avg tiling utilization: {'C': 1.0, 'R': 1.0, 'B': 1.0, 'A': 0.25373134487729926, 'S': 1.0, 'D': 0.9990671641357957}
Llama-3.1-70B decode latency per token: 58852.80034356719
Llama-3.1-70B decode total latency for 2048 tokens: 125179906.33076741
simulated latency: Llama-3.1-70B_decode 125179906.33076741
Testing LLaMA 3.1 8B model prefill
Simulate Running on DRAM PIM
compute module:
simdram config: 8channels x 32ranks x 16banks x 16arrays x 1subarrays x 16384subarr_rows x 1024cols x 8devices, with_PE: True
simdram bw: 13107.2GB/s
simdram internal bw: 4739326.553672316GB/s
simdram ops: 2368.7223119347013Tops
memory capacity: 1024.0GB
peripheral area: 2113.579418320765mm^2
dram area: 33792.0mm^2

memory module: N/A
io module: N/A
LLM model: Llama-3.1-8B
simulating q_proj: Matmul M=1024, K=4096, N=4096
q_proj latency: 14054.400024075198, compute latency: 14054.400001475198, io overhead: 1.6e-06
simulating k_proj: Matmul M=1024, K=4096, N=1024
k_proj latency: 3513.6000228751996, compute latency: 3513.6000005151996, io overhead: 1.3600000000000001e-06
simulating v_proj: Matmul M=1024, K=4096, N=1024
skipping v_proj simulation, using k_proj
v_proj latency: 3513.6000228751996, compute latency: 3513.6000005151996, io overhead: 1.3600000000000001e-06
simulating q_mul_k: Batched_Matmul BS=32 M=1024, K=128, N=1024
Batched Matmul: M=1024, K=128, N=1024, BS=32
BatchedMatmul latency: 14054.400020326399
q_mul_k latency: 14054.400041326398, compute latency: 14054.4000075264, io overhead: 1.28e-05
simulating a_mul_v: Batched_Matmul BS=32 M=1024, K=1024, N=128
Batched Matmul: M=1024, K=1024, N=128, BS=32
BatchedMatmul latency: 14054.400018086399
a_mul_v latency: 14054.400039086398, compute latency: 14054.4000075264, io overhead: 1.056e-05
simulating h_matmul0: Matmul M=1024, K=4096, N=4096
h_matmul0 latency: 14054.400024075198, compute latency: 14054.400001475198, io overhead: 1.6e-06
simulating h1_matmul1: Matmul M=1024, K=4096, N=14336
h1_matmul1 latency: 49190.4000280752, compute latency: 49190.4000046752, io overhead: 2.4000000000000003e-06
simulating h2_matmul2: Matmul M=1024, K=14336, N=4096
h2_matmul2 latency: 49190.4000406064, compute latency: 49190.4000103264, io overhead: 9.28e-06
finish matmul simulation
matmul total overhead: 0.000168
matmul total latency w/o overhead: 161625.6000749952
matmul total latency: 161625.6002429952
weighted avg simd utilization: 0.8695652172142622
weighted avg tiling utilization: {'C': 1.0, 'R': 1.0, 'B': 1.0, 'A': 1.0, 'S': 1.0, 'D': 1.0}
Llama-3.1-8B 32 layers prefill latency: 5172019.212479846
simulated latency: Llama-3.1-8B_prefill 5172019.212479846
Testing LLaMA 3.1 8B model decode
Simulate Running on DRAM PIM
compute module:
simdram config: 8channels x 32ranks x 16banks x 16arrays x 1subarrays x 16384subarr_rows x 1024cols x 8devices, with_PE: True
simdram bw: 13107.2GB/s
simdram internal bw: 4739326.553672316GB/s
simdram ops: 2368.7223119347013Tops
memory capacity: 1024.0GB
peripheral area: 2113.579418320765mm^2
dram area: 33792.0mm^2

memory module: N/A
io module: N/A
simulating q_proj: Matmul M=1, K=4096, N=4096
q_proj latency: 439.2000212555125, compute latency: 439.2000002152, io overhead: 4.03125e-08
simulating k_proj: Matmul M=1, K=4096, N=1024
k_proj latency: 439.20002122527814, compute latency: 439.2000002052, io overhead: 2.0078125e-08
simulating v_proj: Matmul M=1, K=4096, N=1024
skipping v_proj simulation, using k_proj
v_proj latency: 439.20002122527814, compute latency: 439.2000002052, io overhead: 2.0078125e-08
simulating q_mul_k: Batched_Matmul BS=32 M=1, K=128, N=1025
Batched Matmul: M=1, K=128, N=1025, BS=32
BatchedMatmul latency: 14054.40000640898
q_mul_k latency: 14054.40002740898, compute latency: 14054.400006326478, io overhead: 8.250244140624999e-08
simulating a_mul_v: Batched_Matmul BS=32 M=1, K=1025, N=128
Batched Matmul: M=1, K=1025, N=128, BS=32
BatchedMatmul latency: 14054.400006446753
a_mul_v latency: 14054.400027446753, compute latency: 14054.4000064064, io overhead: 4.03515625e-08
simulating h_matmul0: Matmul M=1, K=4096, N=4096
h_matmul0 latency: 439.2000212555125, compute latency: 439.2000002152, io overhead: 4.03125e-08
simulating h1_matmul1: Matmul M=1, K=4096, N=14336
h1_matmul1 latency: 439.20002137645, compute latency: 439.2000002152, io overhead: 1.6125e-07
simulating h2_matmul2: Matmul M=1, K=14336, N=4096
h2_matmul2 latency: 439.20002135551255, compute latency: 439.2000002152, io overhead: 1.403125e-07
finish matmul simulation
matmul total overhead: 0.000168
matmul total latency w/o overhead: 30744.00001454928
matmul total latency: 30744.00018254928
weighted avg simd utilization: 0.006473214478435935
weighted avg tiling utilization: {'C': 1.0, 'R': 1.0, 'B': 1.0, 'A': 0.27142857367031115, 'S': 1.0, 'D': 0.9982142856379757}
Llama-3.1-8B decode latency per token: 30744.000329549282
Llama-3.1-8B decode total latency for 2048 tokens: 63916776.68513296
simulated latency: Llama-3.1-8B_decode 63916776.68513296
