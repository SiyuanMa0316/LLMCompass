Using config: configs/x16_base_config.json
Running GEMM tests...
Test 1: M=1024, K=12288, N=12288
compute module:
simdram config: 8channels x 32ranks x 16banks x 16arrays x 1subarrays x 16384subarr_rows x 1024cols x 8devices, with_PE: True
simdram bw: 13107.2GB/s
simdram internal bw: 4739326.553672316GB/s
simdram ops: 5500.72655737705Tops
memory capacity: 1024.0GB
peripheral area: 2113.579418320765mm^2
dram area: 33792.0mm^2

memory module: N/A
io module: N/A
Running mapping search...
find_simdram_mapping: Best mapping: Strategy(
  Loop Order: mkn  PE Enabled: True  Broadcast: AB
  Array Multicast: False
  Column Popcount: False
  Tile Mapping:  M: CD  N: BA  K: RS  Array Mapping:  R: N  C: MK
  Weight Resident: True
  Input Resident: False
  Output Resident: False
)
Running simulation...
--- Input Matmul Size --- M:1024, K:12288, N:12288
Maximum Array Tile Size: {'M': 16, 'K': 384, 'N': 48}
get_arr_tile_stats: arr_latency=8.0032e-05, capacity_utilization=0.046875
get_tile_stats: K_reduction_latency: 3.072e-05 = 402653184 / 13107200000000.0
CD RS ['B', 'A'] {'C': 1, 'R': 1, 'B': 1, 'A': 1, 'S': 1, 'D': 1}
2097152 = 1024 * 2048 * 1
get_tile_io_latency: data_volume=2097152, dup=['B', 'A'], simd_utilization={'C': 1, 'R': 1, 'B': 1, 'A': 1, 'S': 1, 'D': 1}
get_tile_io_latency: latency=2.56e-06 = 2097152 / 819200000000.0
get_tile_stats: tile_size: {'M': 1024, 'K': 2048, 'N': 12288}, arr_tile_size: {'M': 16, 'K': 64, 'N': 48}, MK_dup: 1, KN_dup:16, MN_dup:64, M_K_io_latency: 2.56e-06, K_N_io_latency: 0, M_N_io_latency: 6.144e-05, tile_compute_latency:0.00011075199999999999 = 8.0032e-05(arr_latency) + 3.072e-05(K_reduction_latency)
================ Strategy Summary ================
Strategy(
  Loop Order: mkn  PE Enabled: True  Broadcast: AB
  Array Multicast: False
  Column Popcount: False
  Tile Mapping:  M: CD  N: BA  K: RS  Array Mapping:  R: N  C: MK
  Weight Resident: True
  Input Resident: False
  Output Resident: False
)

---------------- Tile Sizes ----------------------
| Tile_M      | Tile_N      | Tile_K      |
|-------------|-------------|-------------|
| 1024        | 12288       | 2048        |

| Arr_Tile_M  | Arr_Tile_N  | Arr_Tile_K  |
|-------------|-------------|-------------|
| 16          | 48          | 64          |

--------------- Utilization ----------------------
| Row         | Col         | Array       | Bank        | Device      | Rank        | Channel     |
|-------------|-------------|-------------|-------------|-------------|-------------|-------------|
| 0.046875    | 1.0         | 1           | 1           | 1           | 1           | 1           |

------------------ Latency -----------------------
| Total Latency        | 0.0008027519999999999  cycles|
| Total Compute Latency | 0.0006645119999999999  cycles|
| Total Array Latency  | 0.000480192            cycles|
| Total Reduction Latency| 0.00018432             cycles|
| IO Latency           | 0.00013824             cycles|

----------- Hardware Requirements ---------------
| col_multicast        | False                 |
| col_broadcast        | False                 |
| broadcast            | {'C': False, 'R': False, 'B': True, 'A': True, 'S': False, 'D': False}|
| reduction            | {'C': False, 'R': True, 'B': False, 'A': False, 'S': True, 'D': False}|
==================================================

---------------- Debug Info -----------------------
| Remaining Tiles       |                         |
|-----------------------|-------------------------|
| M_remain              | 0                      |
| N_remain              | 0                      |
| K_remain              | 0                      |

| Fully Partitioned #Tiles |                       |
|-------------------------|-----------------------|
| M_t                   | 1                      |
| N_t                   | 1                      |
| K_t                   | 6                      |

|------------------------|------------------------|
==================================================
Tiling utilization: {'C': 1, 'R': 1, 'B': 1, 'A': 1, 'S': 1, 'D': 1}
Column utilization: 1.0
Capacity utilization: 0.046875
GEMM 1024x12288x12288 latency: 0.0008027519999999999s
simulated latency: GEMM_1024x12288x12288 0.0008027519999999999
roofline_model_simdram: total_ops=309237645312, total_data_movement=25165824, peak_flops=5500726557377050.0, bandwidth=13107200000000.0
roofline_model_simdram: compute_bound_time=5.621759999999999e-05, memory_bound_time=1.92e-06
GEMM roofline latency: 5.621759999999999e-05ms
Results written to test_gemm_x16_base_config.json_1024_12288_12288_simdram_ddr5_operandocality.csv
Test 2: M=2048, K=24576, N=24576
compute module:
simdram config: 8channels x 32ranks x 16banks x 16arrays x 1subarrays x 16384subarr_rows x 1024cols x 8devices, with_PE: True
simdram bw: 13107.2GB/s
simdram internal bw: 4739326.553672316GB/s
simdram ops: 5500.72655737705Tops
memory capacity: 1024.0GB
peripheral area: 2113.579418320765mm^2
dram area: 33792.0mm^2

memory module: N/A
io module: N/A
Running mapping search...
find_simdram_mapping: Best mapping: Strategy(
  Loop Order: mkn  PE Enabled: True  Broadcast: AB
  Array Multicast: False
  Column Popcount: False
  Tile Mapping:  M: CR  N: A  K: BDS  Array Mapping:  R: K  C: MN
  Weight Resident: True
  Input Resident: False
  Output Resident: False
)
Running simulation...
--- Input Matmul Size --- M:2048, K:24576, N:24576
Maximum Array Tile Size: {'M': 8, 'K': 192, 'N': 1536}
get_arr_tile_stats: arr_latency=0.00031895679999999996, capacity_utilization=0.1875
get_tile_stats: K_reduction_latency: 4.096e-05 = 536870912 / 13107200000000.0
CR BDS ['A'] {'C': 1, 'R': 1, 'B': 1, 'A': 1, 'S': 1, 'D': 1}
50331648 = 2048 * 24576 * 1
get_tile_io_latency: data_volume=50331648, dup=['A'], simd_utilization={'C': 1, 'R': 1, 'B': 1, 'A': 1, 'S': 1, 'D': 1}
get_tile_io_latency: latency=3.84e-06 = 50331648 / 13107200000000.0
get_tile_stats: tile_size: {'M': 2048, 'K': 24576, 'N': 2048}, arr_tile_size: {'M': 8, 'K': 192, 'N': 128}, MK_dup: 128, KN_dup:8, MN_dup:1, M_K_io_latency: 0.00049152, K_N_io_latency: 0, M_N_io_latency: 3.2e-07, tile_compute_latency:0.00035991679999999995 = 0.00031895679999999996(arr_latency) + 4.096e-05(K_reduction_latency)
================ Strategy Summary ================
Strategy(
  Loop Order: mkn  PE Enabled: True  Broadcast: AB
  Array Multicast: False
  Column Popcount: False
  Tile Mapping:  M: CR  N: A  K: BDS  Array Mapping:  R: K  C: MN
  Weight Resident: True
  Input Resident: False
  Output Resident: False
)

---------------- Tile Sizes ----------------------
| Tile_M      | Tile_N      | Tile_K      |
|-------------|-------------|-------------|
| 2048        | 2048        | 24576       |

| Arr_Tile_M  | Arr_Tile_N  | Arr_Tile_K  |
|-------------|-------------|-------------|
| 8           | 128         | 192         |

--------------- Utilization ----------------------
| Row         | Col         | Array       | Bank        | Device      | Rank        | Channel     |
|-------------|-------------|-------------|-------------|-------------|-------------|-------------|
| 0.1875      | 1.0         | 1           | 1           | 1           | 1           | 1           |

------------------ Latency -----------------------
| Total Latency        | 0.0048146816000000005  cycles|
| Total Compute Latency | 0.0043190016           cycles|
| Total Array Latency  | 0.0038274815999999987  cycles|
| Total Reduction Latency| 0.00049152             cycles|
| IO Latency           | 0.0004956800000000006  cycles|

----------- Hardware Requirements ---------------
| col_multicast        | True                  |
| col_broadcast        | False                 |
| broadcast            | {'C': False, 'R': False, 'B': False, 'A': True, 'S': False, 'D': False}|
| reduction            | {'C': False, 'R': False, 'B': True, 'A': False, 'S': True, 'D': True}|
==================================================

---------------- Debug Info -----------------------
| Remaining Tiles       |                         |
|-----------------------|-------------------------|
| M_remain              | 0                      |
| N_remain              | 0                      |
| K_remain              | 0                      |

| Fully Partitioned #Tiles |                       |
|-------------------------|-----------------------|
| M_t                   | 1                      |
| N_t                   | 12                     |
| K_t                   | 1                      |

|------------------------|------------------------|
==================================================
Tiling utilization: {'C': 1, 'R': 1, 'B': 1, 'A': 1, 'S': 1, 'D': 1}
Column utilization: 1.0
Capacity utilization: 0.1875
GEMM 2048x24576x24576 latency: 0.0048146816000000005s
simulated latency: GEMM_2048x24576x24576 0.0048146816000000005
roofline_model_simdram: total_ops=2473901162496, total_data_movement=100663296, peak_flops=5500726557377050.0, bandwidth=13107200000000.0
roofline_model_simdram: compute_bound_time=0.0004497407999999999, memory_bound_time=7.68e-06
GEMM roofline latency: 0.0004497407999999999ms
Results written to test_gemm_x16_base_config.json_2048_24576_24576_simdram_ddr5_operandocality.csv
Test 3: M=1, K=12288, N=12288
compute module:
simdram config: 8channels x 32ranks x 16banks x 16arrays x 1subarrays x 16384subarr_rows x 1024cols x 8devices, with_PE: True
simdram bw: 13107.2GB/s
simdram internal bw: 4739326.553672316GB/s
simdram ops: 5500.72655737705Tops
memory capacity: 1024.0GB
peripheral area: 2113.579418320765mm^2
dram area: 33792.0mm^2

memory module: N/A
io module: N/A
Running mapping search...
find_simdram_mapping: Best mapping: Strategy(
  Loop Order: mkn  PE Enabled: True  Broadcast: AB
  Array Multicast: False
  Column Popcount: False
  Tile Mapping:  M:   N: CRA  K: BDS  Array Mapping:  R: M  C: KN
  Weight Resident: True
  Input Resident: False
  Output Resident: False
)
Running simulation...
--- Input Matmul Size --- M:1, K:12288, N:12288
Maximum Array Tile Size: {'M': 1, 'K': 96, 'N': 3}
find_arr_tile: 3 = min(3, 32)
get_arr_tile_stats: arr_latency=2.0496e-06, capacity_utilization=0.0009765625
get_tile_stats: K_reduction_latency: 1.2e-07 = 1572864 / 13107200000000.0
 BDS ['C', 'R', 'A'] {'C': 1, 'R': 1, 'B': 1, 'A': 1, 'S': 1, 'D': 1}
12288 = 1 * 12288 * 1
get_tile_io_latency: data_volume=3145728, dup=['A'], simd_utilization={'C': 1, 'R': 1, 'B': 1, 'A': 1, 'S': 1, 'D': 1}
get_tile_io_latency: latency=2.4e-07 = 3145728 / 13107200000000.0
get_tile_stats: tile_size: {'M': 1, 'K': 12288, 'N': 12288}, arr_tile_size: {'M': 1, 'K': 96, 'N': 3}, MK_dup: 3, KN_dup:1, MN_dup:96, M_K_io_latency: 7.199999999999999e-07, K_N_io_latency: 0, M_N_io_latency: 8.999999999999999e-08, tile_compute_latency:2.1696e-06 = 2.0496e-06(arr_latency) + 1.2e-07(K_reduction_latency)
================ Strategy Summary ================
Strategy(
  Loop Order: mkn  PE Enabled: True  Broadcast: AB
  Array Multicast: False
  Column Popcount: False
  Tile Mapping:  M:   N: CRA  K: BDS  Array Mapping:  R: M  C: KN
  Weight Resident: True
  Input Resident: False
  Output Resident: False
)

---------------- Tile Sizes ----------------------
| Tile_M      | Tile_N      | Tile_K      |
|-------------|-------------|-------------|
| 1           | 12288       | 12288       |

| Arr_Tile_M  | Arr_Tile_N  | Arr_Tile_K  |
|-------------|-------------|-------------|
| 1           | 3           | 96          |

--------------- Utilization ----------------------
| Row         | Col         | Array       | Bank        | Device      | Rank        | Channel     |
|-------------|-------------|-------------|-------------|-------------|-------------|-------------|
| 0.0009765625 | 0.28125     | 1           | 1           | 1           | 1           | 1           |

------------------ Latency -----------------------
| Total Latency        | 3.0696e-06             cycles|
| Total Compute Latency | 2.1696e-06             cycles|
| Total Array Latency  | 2.0496e-06             cycles|
| Total Reduction Latency| 1.2e-07                cycles|
| IO Latency           | 8.999999999999999e-07  cycles|

----------- Hardware Requirements ---------------
| col_multicast        | True                  |
| col_broadcast        | False                 |
| broadcast            | {'C': True, 'R': True, 'B': False, 'A': True, 'S': False, 'D': False}|
| reduction            | {'C': False, 'R': False, 'B': True, 'A': False, 'S': True, 'D': True}|
==================================================

---------------- Debug Info -----------------------
| Remaining Tiles       |                         |
|-----------------------|-------------------------|
| M_remain              | 0                      |
| N_remain              | 0                      |
| K_remain              | 0                      |

| Fully Partitioned #Tiles |                       |
|-------------------------|-----------------------|
| M_t                   | 1                      |
| N_t                   | 1                      |
| K_t                   | 1                      |

|------------------------|------------------------|
==================================================
Tiling utilization: {'C': 1, 'R': 1, 'B': 1, 'A': 1, 'S': 1, 'D': 1}
Column utilization: 0.28125
Capacity utilization: 0.0009765625
GEMM 1x12288x12288 latency: 3.0696e-06s
simulated latency: GEMM_1x12288x12288 3.0696e-06
roofline_model_simdram: total_ops=301989888, total_data_movement=24576, peak_flops=5500726557377050.0, bandwidth=13107200000000.0
roofline_model_simdram: compute_bound_time=5.489999999999999e-08, memory_bound_time=1.875e-09
GEMM roofline latency: 5.489999999999999e-08ms
Results written to test_gemm_x16_base_config.json_1_12288_12288_simdram_ddr5_operandocality.csv
Test 4: M=1, K=24576, N=24576
compute module:
simdram config: 8channels x 32ranks x 16banks x 16arrays x 1subarrays x 16384subarr_rows x 1024cols x 8devices, with_PE: True
simdram bw: 13107.2GB/s
simdram internal bw: 4739326.553672316GB/s
simdram ops: 5500.72655737705Tops
memory capacity: 1024.0GB
peripheral area: 2113.579418320765mm^2
dram area: 33792.0mm^2

memory module: N/A
io module: N/A
Running mapping search...
find_simdram_mapping: Best mapping: Strategy(
  Loop Order: mkn  PE Enabled: True  Broadcast: AB
  Array Multicast: False
  Column Popcount: False
  Tile Mapping:  M:   N: CRA  K: BDS  Array Mapping:  R: M  C: KN
  Weight Resident: True
  Input Resident: False
  Output Resident: False
)
Running simulation...
--- Input Matmul Size --- M:1, K:24576, N:24576
Maximum Array Tile Size: {'M': 1, 'K': 192, 'N': 6}
find_arr_tile: 6 = min(6, 32)
get_arr_tile_stats: arr_latency=2.0496e-06, capacity_utilization=0.0009765625
get_tile_stats: K_reduction_latency: 2.4e-07 = 3145728 / 13107200000000.0
 BDS ['C', 'R', 'A'] {'C': 1, 'R': 1, 'B': 1, 'A': 1, 'S': 1, 'D': 1}
21760 = 1 * 21760 * 1
get_tile_io_latency: data_volume=5570560, dup=['A'], simd_utilization={'C': 1, 'R': 1, 'B': 1, 'A': 1, 'S': 1, 'D': 1}
get_tile_io_latency: latency=4.25e-07 = 5570560 / 13107200000000.0
get_tile_stats: tile_size: {'M': 1, 'K': 21760, 'N': 24576}, arr_tile_size: {'M': 1, 'K': 170, 'N': 6}, MK_dup: 6, KN_dup:1, MN_dup:170, M_K_io_latency: 2.55e-06, K_N_io_latency: 0, M_N_io_latency: 3.1874999999999997e-07, tile_compute_latency:2.2895999999999996e-06 = 2.0496e-06(arr_latency) + 2.4e-07(K_reduction_latency)
get_arr_tile_stats: arr_latency=2.0496e-06, capacity_utilization=0.0009765625
get_tile_stats: K_reduction_latency: 2.4e-07 = 3145728 / 13107200000000.0
 BDS ['C', 'R', 'A'] {'C': 1, 'R': 1, 'B': 1, 'A': 1, 'S': 1, 'D': 1}
2816 = 1 * 2816 * 1
get_tile_io_latency: data_volume=720896, dup=['A'], simd_utilization={'C': 1, 'R': 1, 'B': 1, 'A': 1, 'S': 1, 'D': 1}
get_tile_io_latency: latency=5.5e-08 = 720896 / 13107200000000.0
get_tile_stats: tile_size: {'M': 1, 'K': 2816, 'N': 24576}, arr_tile_size: {'M': 1, 'K': 22, 'N': 6}, MK_dup: 6, KN_dup:1, MN_dup:22, M_K_io_latency: 3.3e-07, K_N_io_latency: 0, M_N_io_latency: 4.1249999999999995e-08, tile_compute_latency:2.2895999999999996e-06 = 2.0496e-06(arr_latency) + 2.4e-07(K_reduction_latency)
================ Strategy Summary ================
Strategy(
  Loop Order: mkn  PE Enabled: True  Broadcast: AB
  Array Multicast: False
  Column Popcount: False
  Tile Mapping:  M:   N: CRA  K: BDS  Array Mapping:  R: M  C: KN
  Weight Resident: True
  Input Resident: False
  Output Resident: False
)

---------------- Tile Sizes ----------------------
| Tile_M      | Tile_N      | Tile_K      |
|-------------|-------------|-------------|
| 1           | 24576       | 21760       |

| Arr_Tile_M  | Arr_Tile_N  | Arr_Tile_K  |
|-------------|-------------|-------------|
| 1           | 6           | 170         |

--------------- Utilization ----------------------
| Row         | Col         | Array       | Bank        | Device      | Rank        | Channel     |
|-------------|-------------|-------------|-------------|-------------|-------------|-------------|
| 0.0009765625 | 0.5625      | 1           | 1           | 1           | 1           | 1           |

------------------ Latency -----------------------
| Total Latency        | 7.8192e-06             cycles|
| Total Compute Latency | 4.579199999999999e-06  cycles|
| Total Array Latency  | 4.0992e-06             cycles|
| Total Reduction Latency| 4.8e-07                cycles|
| IO Latency           | 3.2400000000000003e-06 cycles|

----------- Hardware Requirements ---------------
| col_multicast        | True                  |
| col_broadcast        | False                 |
| broadcast            | {'C': True, 'R': True, 'B': False, 'A': True, 'S': False, 'D': False}|
| reduction            | {'C': False, 'R': False, 'B': True, 'A': False, 'S': True, 'D': True}|
==================================================

---------------- Debug Info -----------------------
| Remaining Tiles       |                         |
|-----------------------|-------------------------|
| M_remain              | 0                      |
| N_remain              | 0                      |
| K_remain              | 2816                   |

| Fully Partitioned #Tiles |                       |
|-------------------------|-----------------------|
| M_t                   | 1                      |
| N_t                   | 1                      |
| K_t                   | 1                      |

|------------------------|------------------------|
==================================================
Tiling utilization: {'C': 1, 'R': 1, 'B': 1, 'A': 1, 'S': 1, 'D': 1}
Column utilization: 0.5625
Capacity utilization: 0.0009765625
GEMM 1x24576x24576 latency: 7.8192e-06s
simulated latency: GEMM_1x24576x24576 7.8192e-06
roofline_model_simdram: total_ops=1207959552, total_data_movement=49152, peak_flops=5500726557377050.0, bandwidth=13107200000000.0
roofline_model_simdram: compute_bound_time=2.1959999999999995e-07, memory_bound_time=3.75e-09
GEMM roofline latency: 2.1959999999999995e-07ms
Results written to test_gemm_x16_base_config.json_1_24576_24576_simdram_ddr5_operandocality.csv
Running LLM tests...
Testing GPT-3 175B model prefill
Simulate Running on DRAM PIM
compute module:
simdram config: 8channels x 32ranks x 16banks x 16arrays x 1subarrays x 16384subarr_rows x 1024cols x 8devices, with_PE: True
simdram bw: 13107.2GB/s
simdram internal bw: 4739326.553672316GB/s
simdram ops: 5500.72655737705Tops
memory capacity: 1024.0GB
peripheral area: 2113.579418320765mm^2
dram area: 33792.0mm^2

memory module: N/A
io module: N/A
LLM model: gpt3-175B
simulating qkv: Matmul M=1024, K=12288, N=12288
qkv latency: 0.0024082559999999997, compute latency: 0.0006645119999999999, io overhead: 0.00013824
simulating q_mul_k: Batched Matmul BS=96 M=1024, K=128, N=1024
Batched Matmul: M=1024, K=128, N=1024, BS=96
BatchedMatmul latency: 5.2496e-06
q_mul_k latency: 5.2496e-06, compute latency: 3.3296e-06, io overhead: 1.9200000000000003e-06
simulating a_mul_v: Batched Matmul BS=96 M=1024, K=1024, N=128
Batched Matmul: M=1024, K=1024, N=128, BS=96
BatchedMatmul latency: 3.6495999999999998e-06
a_mul_v latency: 3.6495999999999998e-06, compute latency: 2.3695999999999997e-06, io overhead: 1.28e-06
simulating h_matmul0: Matmul M=1024, K=12288, N=12288
h_matmul0 latency: 0.0008027519999999999, compute latency: 0.0006645119999999999, io overhead: 0.00013824
simulating h1_matmul1: Matmul M=1024, K=12288, N=49152
h1_matmul1 latency: 0.0026555007999999997, compute latency: 0.0021595008, io overhead: 0.0004959999999999999
simulating h2_matmul2: Matmul M=1024, K=49152, N=12288
h2_matmul2 latency: 0.0025612032, compute latency: 0.0022847232, io overhead: 0.00027648
finish matmul simulation
matmul total overhead: 0
matmul total latency w/o overhead: 0.0084366112
matmul total latency: 0.0084366112
weighted avg simd utilization: 0.9992088766636538
weighted avg tiling utilization: {'C': 1.0, 'R': 1.0, 'B': 1.0, 'A': 1.0, 'S': 1.0, 'D': 1.0}
gpt3-175B 96 layers prefill latency: 0.8099146751999999
simulated latency: gpt3-175B_prefill 0.8099146751999999
Testing GPT-3 175B model decode
Simulate Running on DRAM PIM
compute module:
simdram config: 8channels x 32ranks x 16banks x 16arrays x 1subarrays x 16384subarr_rows x 1024cols x 8devices, with_PE: True
simdram bw: 13107.2GB/s
simdram internal bw: 4739326.553672316GB/s
simdram ops: 5500.72655737705Tops
memory capacity: 1024.0GB
peripheral area: 2113.579418320765mm^2
dram area: 33792.0mm^2

memory module: N/A
io module: N/A
simulating qkv: Matmul M=1, K=12288, N=12288
qkv latency: 9.208799999999999e-06, compute latency: 6.508799999999999e-06, io overhead: 2.6999999999999996e-06, kernel launch overhead: 0
simulating q_mul_k:BatchedMatmul BS=96 M=1, K=128, N=1025
Batched Matmul: M=1, K=128, N=1025, BS=96
BatchedMatmul latency: 2.0599176879882806e-06
q_mul_k latency: 2.0599176879882806e-06, compute latency: 2.0546048828124997e-06, io overhead: 5.31280517578125e-09, kernel launch overhead: 0
simulating a_mul_v: BatchedMatmul BS=96 M=1, K=1025, N=128
Batched Matmul: M=1, K=1025, N=128, BS=96
BatchedMatmul latency: 2.0621415039062495e-06
a_mul_v latency: 2.0621415039062495e-06, compute latency: 2.0595999999999997e-06, io overhead: 2.5415039062499997e-09, kernel launch overhead: 0
simulating h_matmul0: Matmul M=1, K=12288, N=12288
h_matmul0 latency: 3.0696e-06, compute latency: 2.1696e-06, io overhead: 8.999999999999999e-07, kernel launch overhead: 0
simulating h1_matmul1: Matmul M=1, K=12288, N=49152
h1_matmul1 latency: 8.059199999999999e-06, compute latency: 6.0192e-06, io overhead: 2.04e-06, kernel launch overhead: 0
simulating h2_matmul2: Matmul M=1, K=49152, N=12288
h2_matmul2 latency: 7.1288e-06, compute latency: 3.7688e-06, io overhead: 3.3599999999999996e-06, kernel launch overhead: 0
finish matmul simulation
matmul total overhead: 0
matmul total latency w/o overhead: 3.158845919189453e-05
matmul total latency: 3.158845919189453e-05
weighted avg simd utilization: 0.4223457312625898
weighted avg tiling utilization: {'C': 1.0, 'R': 1.0, 'B': 1.0, 'A': 0.8980548804277709, 'S': 1.0, 'D': 1.0}
transformer latency: 3.158845919189453e-05
gpt3-175B decode latency per token: 3.158845919189453e-05
gpt3-175B decode total latency for 2048 tokens: 6.210543784799999
simulated latency: gpt3-175B_decode 6.210543784799999
Testing GPT-3 6.7B model prefill
Simulate Running on DRAM PIM
compute module:
simdram config: 8channels x 32ranks x 16banks x 16arrays x 1subarrays x 16384subarr_rows x 1024cols x 8devices, with_PE: True
simdram bw: 13107.2GB/s
simdram internal bw: 4739326.553672316GB/s
simdram ops: 5500.72655737705Tops
memory capacity: 1024.0GB
peripheral area: 2113.579418320765mm^2
dram area: 33792.0mm^2

memory module: N/A
io module: N/A
LLM model: gpt3-6.7B
simulating qkv: Matmul M=1024, K=4096, N=4096
qkv latency: 0.0003524544, compute latency: 9.444480000000001e-05, io overhead: 2.304e-05
simulating q_mul_k: Batched Matmul BS=32 M=1024, K=128, N=1024
Batched Matmul: M=1024, K=128, N=1024, BS=32
BatchedMatmul latency: 5.2496e-06
q_mul_k latency: 5.2496e-06, compute latency: 3.3296e-06, io overhead: 1.9200000000000003e-06
simulating a_mul_v: Batched Matmul BS=32 M=1024, K=1024, N=128
Batched Matmul: M=1024, K=1024, N=128, BS=32
BatchedMatmul latency: 3.6495999999999998e-06
a_mul_v latency: 3.6495999999999998e-06, compute latency: 2.3695999999999997e-06, io overhead: 1.28e-06
simulating h_matmul0: Matmul M=1024, K=4096, N=4096
h_matmul0 latency: 0.0001174848, compute latency: 9.444480000000001e-05, io overhead: 2.304e-05
simulating h1_matmul1: Matmul M=1024, K=4096, N=16384
h1_matmul1 latency: 0.00043921920000000004, compute latency: 0.00037777920000000003, io overhead: 6.144e-05
simulating h2_matmul2: Matmul M=1024, K=16384, N=4096
h2_matmul2 latency: 0.00034705920000000005, compute latency: 0.0002548992, io overhead: 9.216000000000001e-05
finish matmul simulation
matmul total overhead: 0
matmul total latency w/o overhead: 0.0012651168000000002
matmul total latency: 0.0012651168000000002
weighted avg simd utilization: 0.9947242815841193
weighted avg tiling utilization: {'C': 1.0, 'R': 1.0, 'B': 1.0, 'A': 1.0, 'S': 1.0, 'D': 1.0}
gpt3-6.7B 32 layers prefill latency: 0.04048373760000001
simulated latency: gpt3-6.7B_prefill 0.04048373760000001
Testing GPT-3 6.7B model decode
Simulate Running on DRAM PIM
compute module:
simdram config: 8channels x 32ranks x 16banks x 16arrays x 1subarrays x 16384subarr_rows x 1024cols x 8devices, with_PE: True
simdram bw: 13107.2GB/s
simdram internal bw: 4739326.553672316GB/s
simdram ops: 5500.72655737705Tops
memory capacity: 1024.0GB
peripheral area: 2113.579418320765mm^2
dram area: 33792.0mm^2

memory module: N/A
io module: N/A
simulating qkv: Matmul M=1, K=4096, N=4096
qkv latency: 6.568799999999999e-06, compute latency: 6.2688e-06, io overhead: 3e-07, kernel launch overhead: 0
simulating q_mul_k:BatchedMatmul BS=32 M=1, K=128, N=1025
Batched Matmul: M=1, K=128, N=1025, BS=32
BatchedMatmul latency: 2.0599176879882806e-06
q_mul_k latency: 2.0599176879882806e-06, compute latency: 2.0546048828124997e-06, io overhead: 5.31280517578125e-09, kernel launch overhead: 0
simulating a_mul_v: BatchedMatmul BS=32 M=1, K=1025, N=128
Batched Matmul: M=1, K=1025, N=128, BS=32
BatchedMatmul latency: 2.0621415039062495e-06
a_mul_v latency: 2.0621415039062495e-06, compute latency: 2.0595999999999997e-06, io overhead: 2.5415039062499997e-09, kernel launch overhead: 0
simulating h_matmul0: Matmul M=1, K=4096, N=4096
h_matmul0 latency: 2.1895999999999998e-06, compute latency: 2.0896e-06, io overhead: 1e-07, kernel launch overhead: 0
simulating h1_matmul1: Matmul M=1, K=4096, N=16384
h1_matmul1 latency: 2.6096e-06, compute latency: 2.2096e-06, io overhead: 4e-07, kernel launch overhead: 0
simulating h2_matmul2: Matmul M=1, K=16384, N=4096
h2_matmul2 latency: 2.4896e-06, compute latency: 2.0896e-06, io overhead: 4e-07, kernel launch overhead: 0
finish matmul simulation
matmul total overhead: 0
matmul total latency w/o overhead: 1.797965919189453e-05
matmul total latency: 1.797965919189453e-05
weighted avg simd utilization: 0.051121708540144875
weighted avg tiling utilization: {'C': 1.0, 'R': 1.0, 'B': 1.0, 'A': 0.8208926423437485, 'S': 1.0, 'D': 1.0}
transformer latency: 1.797965919189453e-05
gpt3-6.7B decode latency per token: 1.797965919189453e-05
gpt3-6.7B decode total latency for 2048 tokens: 1.1783149447999999
simulated latency: gpt3-6.7B_decode 1.1783149447999999
Testing LLaMA 3.1 70B model prefill
Simulate Running on DRAM PIM
compute module:
simdram config: 8channels x 32ranks x 16banks x 16arrays x 1subarrays x 16384subarr_rows x 1024cols x 8devices, with_PE: True
simdram bw: 13107.2GB/s
simdram internal bw: 4739326.553672316GB/s
simdram ops: 5500.72655737705Tops
memory capacity: 1024.0GB
peripheral area: 2113.579418320765mm^2
dram area: 33792.0mm^2

memory module: N/A
io module: N/A
LLM model: Llama-3.1-70B
simulating q_proj: Matmul M=1024, K=8192, N=8192
q_proj latency: 0.00038801920000000004, compute latency: 0.0002958592, io overhead: 9.216000000000001e-05
simulating k_proj: Matmul M=1024, K=8192, N=1024
k_proj latency: 5.6768e-05, compute latency: 4.7808e-05, io overhead: 8.96e-06
simulating v_proj: Matmul M=1024, K=8192, N=1024
skipping v_proj simulation, using k_proj
v_proj latency: 5.6768e-05, compute latency: 4.7808e-05, io overhead: 8.96e-06
simulating q_mul_k: Batched_Matmul BS=64 M=1024, K=128, N=1024
Batched Matmul: M=1024, K=128, N=1024, BS=64
BatchedMatmul latency: 5.2496e-06
q_mul_k latency: 5.2496e-06, compute latency: 3.3296e-06, io overhead: 1.9200000000000003e-06
simulating a_mul_v: Batched_Matmul BS=64 M=1024, K=1024, N=128
Batched Matmul: M=1024, K=1024, N=128, BS=64
BatchedMatmul latency: 3.6495999999999998e-06
a_mul_v latency: 3.6495999999999998e-06, compute latency: 2.3695999999999997e-06, io overhead: 1.28e-06
simulating h_matmul0: Matmul M=1024, K=8192, N=8192
h_matmul0 latency: 0.00038801920000000004, compute latency: 0.0002958592, io overhead: 9.216000000000001e-05
simulating h1_matmul1: Matmul M=1024, K=8192, N=28672
h1_matmul1 latency: 0.001198752, compute latency: 0.001030432, io overhead: 0.00016832000000000001
simulating h2_matmul2: Matmul M=1024, K=28672, N=8192
h2_matmul2 latency: 0.0010711744, compute latency: 0.0008894143999999999, io overhead: 0.00018176000000000002
finish matmul simulation
matmul total overhead: 0
matmul total latency w/o overhead: 0.0031684
matmul total latency: 0.0031684
weighted avg simd utilization: 0.9978934477969953
weighted avg tiling utilization: {'C': 1.0, 'R': 1.0, 'B': 1.0, 'A': 1.0, 'S': 1.0, 'D': 1.0}
Llama-3.1-70B 80 layers prefill latency: 0.25347200000000003
simulated latency: Llama-3.1-70B_prefill 0.25347200000000003
Testing LLaMA 3.1 70B model decode
Simulate Running on DRAM PIM
compute module:
simdram config: 8channels x 32ranks x 16banks x 16arrays x 1subarrays x 16384subarr_rows x 1024cols x 8devices, with_PE: True
simdram bw: 13107.2GB/s
simdram internal bw: 4739326.553672316GB/s
simdram ops: 5500.72655737705Tops
memory capacity: 1024.0GB
peripheral area: 2113.579418320765mm^2
dram area: 33792.0mm^2

memory module: N/A
io module: N/A
simulating q_proj: Matmul M=1, K=8192, N=8192
q_proj latency: 2.5296e-06, compute latency: 2.1296e-06, io overhead: 4e-07
simulating k_proj: Matmul M=1, K=8192, N=1024
k_proj latency: 2.1321e-06, compute latency: 2.0896e-06, io overhead: 4.2500000000000003e-08
simulating v_proj: Matmul M=1, K=8192, N=1024
skipping v_proj simulation, using k_proj
v_proj latency: 2.1321e-06, compute latency: 2.0896e-06, io overhead: 4.2500000000000003e-08
simulating q_mul_k: Batched_Matmul BS=64 M=1, K=128, N=1025
Batched Matmul: M=1, K=128, N=1025, BS=64
BatchedMatmul latency: 2.0599176879882806e-06
q_mul_k latency: 2.0599176879882806e-06, compute latency: 2.0546048828124997e-06, io overhead: 5.31280517578125e-09
simulating a_mul_v: Batched_Matmul BS=64 M=1, K=1025, N=128
Batched Matmul: M=1, K=1025, N=128, BS=64
BatchedMatmul latency: 2.0621415039062495e-06
a_mul_v latency: 2.0621415039062495e-06, compute latency: 2.0595999999999997e-06, io overhead: 2.5415039062499997e-09
simulating h_matmul0: Matmul M=1, K=8192, N=8192
h_matmul0 latency: 2.5296e-06, compute latency: 2.1296e-06, io overhead: 4e-07
simulating h1_matmul1: Matmul M=1, K=8192, N=28672
h1_matmul1 latency: 3.7296e-06, compute latency: 2.3295999999999997e-06, io overhead: 1.4e-06
simulating h2_matmul2: Matmul M=1, K=28672, N=8192
h2_matmul2 latency: 3.4696e-06, compute latency: 2.2096e-06, io overhead: 1.26e-06
finish matmul simulation
matmul total overhead: 0
matmul total latency w/o overhead: 2.0644659191894532e-05
matmul total latency: 2.0644659191894532e-05
weighted avg simd utilization: 0.18681485540693207
weighted avg tiling utilization: {'C': 1.0, 'R': 1.0, 'B': 1.0, 'A': 0.8440134458269716, 'S': 1.0, 'D': 1.0}
Llama-3.1-70B decode latency per token: 2.0644659191894532e-05
Llama-3.1-70B decode total latency for 2048 tokens: 3.3824209620000003
simulated latency: Llama-3.1-70B_decode 3.3824209620000003
Testing LLaMA 3.1 8B model prefill
Simulate Running on DRAM PIM
compute module:
simdram config: 8channels x 32ranks x 16banks x 16arrays x 1subarrays x 16384subarr_rows x 1024cols x 8devices, with_PE: True
simdram bw: 13107.2GB/s
simdram internal bw: 4739326.553672316GB/s
simdram ops: 5500.72655737705Tops
memory capacity: 1024.0GB
peripheral area: 2113.579418320765mm^2
dram area: 33792.0mm^2

memory module: N/A
io module: N/A
LLM model: Llama-3.1-8B
simulating q_proj: Matmul M=1024, K=4096, N=4096
q_proj latency: 0.0001174848, compute latency: 9.444480000000001e-05, io overhead: 2.304e-05
simulating k_proj: Matmul M=1024, K=4096, N=1024
k_proj latency: 3.1584e-05, compute latency: 2.3904e-05, io overhead: 7.680000000000001e-06
simulating v_proj: Matmul M=1024, K=4096, N=1024
skipping v_proj simulation, using k_proj
v_proj latency: 3.1584e-05, compute latency: 2.3904e-05, io overhead: 7.680000000000001e-06
simulating q_mul_k: Batched_Matmul BS=32 M=1024, K=128, N=1024
Batched Matmul: M=1024, K=128, N=1024, BS=32
BatchedMatmul latency: 5.2496e-06
q_mul_k latency: 5.2496e-06, compute latency: 3.3296e-06, io overhead: 1.9200000000000003e-06
simulating a_mul_v: Batched_Matmul BS=32 M=1024, K=1024, N=128
Batched Matmul: M=1024, K=1024, N=128, BS=32
BatchedMatmul latency: 3.6495999999999998e-06
a_mul_v latency: 3.6495999999999998e-06, compute latency: 2.3695999999999997e-06, io overhead: 1.28e-06
simulating h_matmul0: Matmul M=1024, K=4096, N=4096
h_matmul0 latency: 0.0001174848, compute latency: 9.444480000000001e-05, io overhead: 2.304e-05
simulating h1_matmul1: Matmul M=1024, K=4096, N=14336
h1_matmul1 latency: 0.000385792, compute latency: 0.000330752, io overhead: 5.504000000000001e-05
simulating h2_matmul2: Matmul M=1024, K=14336, N=4096
h2_matmul2 latency: 0.00031912320000000006, compute latency: 0.00026024319999999997, io overhead: 5.8880000000000005e-05
finish matmul simulation
matmul total overhead: 0
matmul total latency w/o overhead: 0.001011952
matmul total latency: 0.001011952
weighted avg simd utilization: 0.9934044302496561
weighted avg tiling utilization: {'C': 1.0, 'R': 1.0, 'B': 1.0, 'A': 1.0, 'S': 1.0, 'D': 1.0}
Llama-3.1-8B 32 layers prefill latency: 0.032382464
simulated latency: Llama-3.1-8B_prefill 0.032382464
Testing LLaMA 3.1 8B model decode
Simulate Running on DRAM PIM
compute module:
simdram config: 8channels x 32ranks x 16banks x 16arrays x 1subarrays x 16384subarr_rows x 1024cols x 8devices, with_PE: True
simdram bw: 13107.2GB/s
simdram internal bw: 4739326.553672316GB/s
simdram ops: 5500.72655737705Tops
memory capacity: 1024.0GB
peripheral area: 2113.579418320765mm^2
dram area: 33792.0mm^2

memory module: N/A
io module: N/A
simulating q_proj: Matmul M=1, K=4096, N=4096
q_proj latency: 2.1895999999999998e-06, compute latency: 2.0896e-06, io overhead: 1e-07
simulating k_proj: Matmul M=1, K=4096, N=1024
k_proj latency: 2.11085e-06, compute latency: 2.0896e-06, io overhead: 2.1250000000000002e-08
simulating v_proj: Matmul M=1, K=4096, N=1024
skipping v_proj simulation, using k_proj
v_proj latency: 2.11085e-06, compute latency: 2.0896e-06, io overhead: 2.1250000000000002e-08
simulating q_mul_k: Batched_Matmul BS=32 M=1, K=128, N=1025
Batched Matmul: M=1, K=128, N=1025, BS=32
BatchedMatmul latency: 2.0599176879882806e-06
q_mul_k latency: 2.0599176879882806e-06, compute latency: 2.0546048828124997e-06, io overhead: 5.31280517578125e-09
simulating a_mul_v: Batched_Matmul BS=32 M=1, K=1025, N=128
Batched Matmul: M=1, K=1025, N=128, BS=32
BatchedMatmul latency: 2.0621415039062495e-06
a_mul_v latency: 2.0621415039062495e-06, compute latency: 2.0595999999999997e-06, io overhead: 2.5415039062499997e-09
simulating h_matmul0: Matmul M=1, K=4096, N=4096
h_matmul0 latency: 2.1895999999999998e-06, compute latency: 2.0896e-06, io overhead: 1e-07
simulating h1_matmul1: Matmul M=1, K=4096, N=14336
h1_matmul1 latency: 2.5796e-06, compute latency: 2.1895999999999998e-06, io overhead: 3.8999999999999997e-07
simulating h2_matmul2: Matmul M=1, K=14336, N=4096
h2_matmul2 latency: 2.4396e-06, compute latency: 2.0896e-06, io overhead: 3.5e-07
finish matmul simulation
matmul total overhead: 0
matmul total latency w/o overhead: 1.7742159191894527e-05
matmul total latency: 1.7742159191894527e-05
weighted avg simd utilization: 0.04323961755791519
weighted avg tiling utilization: {'C': 1.0, 'R': 1.0, 'B': 1.0, 'A': 0.8184950763551176, 'S': 1.0, 'D': 1.0}
Llama-3.1-8B decode latency per token: 1.7742159191894527e-05
Llama-3.1-8B decode total latency for 2048 tokens: 1.1627501447999997
simulated latency: Llama-3.1-8B_decode 1.1627501447999997
/home/siyuan/LLMCompass/exp_scripts/ablation_accumulative
