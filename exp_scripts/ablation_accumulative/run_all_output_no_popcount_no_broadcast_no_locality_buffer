Using config: configs/x16_base_config.json
Running GEMM tests...
Test 1: M=1024, K=12288, N=12288
compute module:
simdram config: 8channels x 32ranks x 16banks x 16arrays x 1subarrays x 16384subarr_rows x 1024cols x 8devices, with_PE: True
simdram logical config: 8channels x 32ranks x 16banks x 8arrays x 1subarrays x 131072subarr_rows x 256cols x 8devices, with_PE: True
simdram bw: 13107.2GB/s
simdram internal bw: 4739326.553672316GB/s
simdram ops: 687.5908196721313Tops
memory capacity: 1024.0GB
peripheral area: 830.6070382046778mm^2
dram area: 33792.0mm^2

memory module: N/A
io module: N/A
Running mapping search...
find_simdram_mapping: Best mapping: Strategy(
  Loop Order: mkn  PE Enabled: True  Broadcast: 
  Array Multicast: False
  Column Popcount: False
  Tile Mapping:  M: CR  N: B  K: ADS  Array Mapping:  R: N  C: MK
  Weight Resident: True
  Input Resident: False
  Output Resident: False
)
Running simulation...
--- Input Matmul Size --- M:1024, K:12288, N:12288
Maximum Array Tile Size: {'M': 4, 'K': 192, 'N': 768}
get_arr_tile_stats: arr_latency=0.00083584, capacity_utilization=0.09375
get_tile_stats: K_reduction_latency: 6.144e-05 = 805306368 / 13107200000000.0
CR ADS ['B'] {'C': 1, 'R': 1, 'B': 1, 'A': 1, 'S': 1, 'D': 1}
4194304 = 1024 * 4096 * 1
get_tile_io_latency: data_volume=67108864, dup=[], simd_utilization={'C': 1, 'R': 1, 'B': 1, 'A': 1, 'S': 1, 'D': 1}
get_tile_io_latency: latency=5.12e-06 = 67108864 / 13107200000000.0
get_tile_stats: tile_size: {'M': 1024, 'K': 4096, 'N': 12288}, arr_tile_size: {'M': 4, 'K': 64, 'N': 768}, MK_dup: 1, KN_dup:4, MN_dup:64, M_K_io_latency: 5.12e-06, K_N_io_latency: 0, M_N_io_latency: 6.144e-05, tile_compute_latency:0.00089728 = 0.00083584(arr_latency) + 6.144e-05(K_reduction_latency)
================ Strategy Summary ================
Strategy(
  Loop Order: mkn  PE Enabled: True  Broadcast: 
  Array Multicast: False
  Column Popcount: False
  Tile Mapping:  M: CR  N: B  K: ADS  Array Mapping:  R: N  C: MK
  Weight Resident: True
  Input Resident: False
  Output Resident: False
)

---------------- Tile Sizes ----------------------
| Tile_M      | Tile_N      | Tile_K      |
|-------------|-------------|-------------|
| 1024        | 12288       | 4096        |

| Arr_Tile_M  | Arr_Tile_N  | Arr_Tile_K  |
|-------------|-------------|-------------|
| 4           | 768         | 64          |

--------------- Utilization ----------------------
| Row         | Col         | Array       | Bank        | Device      | Rank        | Channel     |
|-------------|-------------|-------------|-------------|-------------|-------------|-------------|
| 0.09375     | 1.0         | 1           | 1           | 1           | 1           | 1           |

------------------ Latency -----------------------
| Total Latency        | 0.0028300799999999996  cycles|
| Total Compute Latency | 0.00269184             cycles|
| Total Array Latency  | 0.00250752             cycles|
| Total Reduction Latency| 0.00018431999999999997 cycles|
| IO Latency           | 0.00013824             cycles|

----------- Hardware Requirements ---------------
| col_multicast        | False                 |
| col_broadcast        | False                 |
| broadcast            | {'C': False, 'R': False, 'B': True, 'A': False, 'S': False, 'D': False}|
| reduction            | {'C': False, 'R': False, 'B': False, 'A': True, 'S': True, 'D': True}|
==================================================

---------------- Debug Info -----------------------
| Remaining Tiles       |                         |
|-----------------------|-------------------------|
| M_remain              | 0                      |
| N_remain              | 0                      |
| K_remain              | 0                      |

| Fully Partitioned #Tiles |                       |
|-------------------------|-----------------------|
| M_t                   | 1                      |
| N_t                   | 1                      |
| K_t                   | 3                      |

|------------------------|------------------------|
==================================================
Tiling utilization: {'C': 1, 'R': 1, 'B': 1, 'A': 1, 'S': 1, 'D': 1}
Column utilization: 1.0
Capacity utilization: 0.09375
GEMM 1024x12288x12288 latency: 0.0028300799999999996s
simulated latency: GEMM_1024x12288x12288 0.0028300799999999996
roofline_model_simdram: total_ops=309237645312, total_data_movement=25165824, peak_flops=687590819672131.2, bandwidth=13107200000000.0
roofline_model_simdram: compute_bound_time=0.0004497407999999999, memory_bound_time=1.92e-06
GEMM roofline latency: 0.0004497407999999999ms
Results written to test_gemm_x16_base_config.json_1024_12288_12288_simdram_ddr5_operandocality.csv
Test 2: M=2048, K=24576, N=24576
compute module:
simdram config: 8channels x 32ranks x 16banks x 16arrays x 1subarrays x 16384subarr_rows x 1024cols x 8devices, with_PE: True
simdram logical config: 8channels x 32ranks x 16banks x 8arrays x 1subarrays x 131072subarr_rows x 256cols x 8devices, with_PE: True
simdram bw: 13107.2GB/s
simdram internal bw: 4739326.553672316GB/s
simdram ops: 687.5908196721313Tops
memory capacity: 1024.0GB
peripheral area: 830.6070382046778mm^2
dram area: 33792.0mm^2

memory module: N/A
io module: N/A
Running mapping search...
find_simdram_mapping: Best mapping: Strategy(
  Loop Order: mkn  PE Enabled: True  Broadcast: 
  Array Multicast: False
  Column Popcount: False
  Tile Mapping:  M: C  N: BA  K: RDS  Array Mapping:  R: KN  C: M
  Weight Resident: True
  Input Resident: False
  Output Resident: False
)
Running simulation...
--- Input Matmul Size --- M:2048, K:24576, N:24576
Maximum Array Tile Size: {'M': 256, 'K': 96, 'N': 192}
get_arr_tile_stats: arr_latency=0.0133696, capacity_utilization=0.75
get_tile_stats: K_reduction_latency: 0.00065536 = 8589934592 / 13107200000000.0
C RDS ['B', 'A'] {'C': 1, 'R': 1, 'B': 1, 'A': 1, 'S': 1, 'D': 1}
50331648 = 2048 * 24576 * 1
get_tile_io_latency: data_volume=6442450944, dup=[], simd_utilization={'C': 1, 'R': 1, 'B': 1, 'A': 1, 'S': 1, 'D': 1}
get_tile_io_latency: latency=0.00049152 = 6442450944 / 13107200000000.0
get_tile_stats: tile_size: {'M': 2048, 'K': 24576, 'N': 16384}, arr_tile_size: {'M': 256, 'K': 96, 'N': 128}, MK_dup: 1, KN_dup:256, MN_dup:1, M_K_io_latency: 0.00049152, K_N_io_latency: 0, M_N_io_latency: 2.56e-06, tile_compute_latency:0.014024960000000001 = 0.0133696(arr_latency) + 0.00065536(K_reduction_latency)
get_arr_tile_stats: arr_latency=0.006684928, capacity_utilization=0.375
get_tile_stats: K_reduction_latency: 0.00032768 = 4294967296 / 13107200000000.0
C RDS ['B', 'A'] {'C': 1, 'R': 1, 'B': 1, 'A': 1, 'S': 1, 'D': 1}
50331648 = 2048 * 24576 * 1
get_tile_io_latency: data_volume=6442450944, dup=[], simd_utilization={'C': 1, 'R': 1, 'B': 1, 'A': 1, 'S': 1, 'D': 1}
get_tile_io_latency: latency=0.00049152 = 6442450944 / 13107200000000.0
get_tile_stats: tile_size: {'M': 2048, 'K': 24576, 'N': 8192}, arr_tile_size: {'M': 256, 'K': 96, 'N': 64}, MK_dup: 1, KN_dup:256, MN_dup:1, M_K_io_latency: 0.00049152, K_N_io_latency: 0, M_N_io_latency: 1.28e-06, tile_compute_latency:0.007012608 = 0.006684928(arr_latency) + 0.00032768(K_reduction_latency)
================ Strategy Summary ================
Strategy(
  Loop Order: mkn  PE Enabled: True  Broadcast: 
  Array Multicast: False
  Column Popcount: False
  Tile Mapping:  M: C  N: BA  K: RDS  Array Mapping:  R: KN  C: M
  Weight Resident: True
  Input Resident: False
  Output Resident: False
)

---------------- Tile Sizes ----------------------
| Tile_M      | Tile_N      | Tile_K      |
|-------------|-------------|-------------|
| 2048        | 16384       | 24576       |

| Arr_Tile_M  | Arr_Tile_N  | Arr_Tile_K  |
|-------------|-------------|-------------|
| 256         | 128         | 96          |

--------------- Utilization ----------------------
| Row         | Col         | Array       | Bank        | Device      | Rank        | Channel     |
|-------------|-------------|-------------|-------------|-------------|-------------|-------------|
| 0.75        | 1.0         | 1           | 1           | 1           | 1           | 1           |

------------------ Latency -----------------------
| Total Latency        | 0.021534208            cycles|
| Total Compute Latency | 0.021037568            cycles|
| Total Array Latency  | 0.020054528000000002   cycles|
| Total Reduction Latency| 0.0009830400000000001  cycles|
| IO Latency           | 0.0004966399999999999  cycles|

----------- Hardware Requirements ---------------
| col_multicast        | False                 |
| col_broadcast        | False                 |
| broadcast            | {'C': False, 'R': False, 'B': True, 'A': True, 'S': False, 'D': False}|
| reduction            | {'C': False, 'R': True, 'B': False, 'A': False, 'S': True, 'D': True}|
==================================================

---------------- Debug Info -----------------------
| Remaining Tiles       |                         |
|-----------------------|-------------------------|
| M_remain              | 0                      |
| N_remain              | 8192                   |
| K_remain              | 0                      |

| Fully Partitioned #Tiles |                       |
|-------------------------|-----------------------|
| M_t                   | 1                      |
| N_t                   | 1                      |
| K_t                   | 1                      |

|------------------------|------------------------|
==================================================
Tiling utilization: {'C': 1, 'R': 1, 'B': 1, 'A': 1, 'S': 1, 'D': 1}
Column utilization: 1.0
Capacity utilization: 0.75
GEMM 2048x24576x24576 latency: 0.021534208s
simulated latency: GEMM_2048x24576x24576 0.021534208
roofline_model_simdram: total_ops=2473901162496, total_data_movement=100663296, peak_flops=687590819672131.2, bandwidth=13107200000000.0
roofline_model_simdram: compute_bound_time=0.0035979263999999993, memory_bound_time=7.68e-06
GEMM roofline latency: 0.0035979263999999993ms
Results written to test_gemm_x16_base_config.json_2048_24576_24576_simdram_ddr5_operandocality.csv
Test 3: M=1, K=12288, N=12288
compute module:
simdram config: 8channels x 32ranks x 16banks x 16arrays x 1subarrays x 16384subarr_rows x 1024cols x 8devices, with_PE: True
simdram logical config: 8channels x 32ranks x 16banks x 8arrays x 1subarrays x 131072subarr_rows x 256cols x 8devices, with_PE: True
simdram bw: 13107.2GB/s
simdram internal bw: 4739326.553672316GB/s
simdram ops: 687.5908196721313Tops
memory capacity: 1024.0GB
peripheral area: 830.6070382046778mm^2
dram area: 33792.0mm^2

memory module: N/A
io module: N/A
Running mapping search...
find_simdram_mapping: Best mapping: Strategy(
  Loop Order: mkn  PE Enabled: True  Broadcast: 
  Array Multicast: False
  Column Popcount: False
  Tile Mapping:  M:   N: CRB  K: ADS  Array Mapping:  R: MN  C: K
  Weight Resident: True
  Input Resident: False
  Output Resident: False
)
Running simulation...
--- Input Matmul Size --- M:1, K:12288, N:12288
Maximum Array Tile Size: {'M': 1, 'K': 192, 'N': 3}
get_arr_tile_stats: arr_latency=3.52e-06, capacity_utilization=0.00018310546875
get_tile_stats: K_reduction_latency: 6e-08 = 786432 / 13107200000000.0
 ADS ['C', 'R', 'B'] {'C': 1, 'R': 1, 'B': 1, 'A': 1, 'S': 1, 'D': 1}
12288 = 1 * 12288 * 1
get_tile_io_latency: data_volume=50331648, dup=[], simd_utilization={'C': 1, 'R': 1, 'B': 1, 'A': 1, 'S': 1, 'D': 1}
get_tile_io_latency: latency=3.84e-06 = 50331648 / 13107200000000.0
get_tile_stats: tile_size: {'M': 1, 'K': 12288, 'N': 12288}, arr_tile_size: {'M': 1, 'K': 192, 'N': 3}, MK_dup: 1, KN_dup:1, MN_dup:192, M_K_io_latency: 3.84e-06, K_N_io_latency: 0, M_N_io_latency: 1.7999999999999997e-07, tile_compute_latency:3.58e-06 = 3.52e-06(arr_latency) + 6e-08(K_reduction_latency)
================ Strategy Summary ================
Strategy(
  Loop Order: mkn  PE Enabled: True  Broadcast: 
  Array Multicast: False
  Column Popcount: False
  Tile Mapping:  M:   N: CRB  K: ADS  Array Mapping:  R: MN  C: K
  Weight Resident: True
  Input Resident: False
  Output Resident: False
)

---------------- Tile Sizes ----------------------
| Tile_M      | Tile_N      | Tile_K      |
|-------------|-------------|-------------|
| 1           | 12288       | 12288       |

| Arr_Tile_M  | Arr_Tile_N  | Arr_Tile_K  |
|-------------|-------------|-------------|
| 1           | 3           | 192         |

--------------- Utilization ----------------------
| Row         | Col         | Array       | Bank        | Device      | Rank        | Channel     |
|-------------|-------------|-------------|-------------|-------------|-------------|-------------|
| 0.00018310546875 | 0.75        | 1           | 1           | 1           | 1           | 1           |

------------------ Latency -----------------------
| Total Latency        | 7.78e-06               cycles|
| Total Compute Latency | 3.58e-06               cycles|
| Total Array Latency  | 3.52e-06               cycles|
| Total Reduction Latency| 6e-08                  cycles|
| IO Latency           | 4.2e-06                cycles|

----------- Hardware Requirements ---------------
| col_multicast        | False                 |
| col_broadcast        | False                 |
| broadcast            | {'C': True, 'R': True, 'B': True, 'A': False, 'S': False, 'D': False}|
| reduction            | {'C': False, 'R': False, 'B': False, 'A': True, 'S': True, 'D': True}|
==================================================

---------------- Debug Info -----------------------
| Remaining Tiles       |                         |
|-----------------------|-------------------------|
| M_remain              | 0                      |
| N_remain              | 0                      |
| K_remain              | 0                      |

| Fully Partitioned #Tiles |                       |
|-------------------------|-----------------------|
| M_t                   | 1                      |
| N_t                   | 1                      |
| K_t                   | 1                      |

|------------------------|------------------------|
==================================================
Tiling utilization: {'C': 1, 'R': 1, 'B': 1, 'A': 1, 'S': 1, 'D': 1}
Column utilization: 0.75
Capacity utilization: 0.00018310546875
GEMM 1x12288x12288 latency: 7.78e-06s
simulated latency: GEMM_1x12288x12288 7.78e-06
roofline_model_simdram: total_ops=301989888, total_data_movement=24576, peak_flops=687590819672131.2, bandwidth=13107200000000.0
roofline_model_simdram: compute_bound_time=4.391999999999999e-07, memory_bound_time=1.875e-09
GEMM roofline latency: 4.391999999999999e-07ms
Results written to test_gemm_x16_base_config.json_1_12288_12288_simdram_ddr5_operandocality.csv
Test 4: M=1, K=24576, N=24576
compute module:
simdram config: 8channels x 32ranks x 16banks x 16arrays x 1subarrays x 16384subarr_rows x 1024cols x 8devices, with_PE: True
simdram logical config: 8channels x 32ranks x 16banks x 8arrays x 1subarrays x 131072subarr_rows x 256cols x 8devices, with_PE: True
simdram bw: 13107.2GB/s
simdram internal bw: 4739326.553672316GB/s
simdram ops: 687.5908196721313Tops
memory capacity: 1024.0GB
peripheral area: 830.6070382046778mm^2
dram area: 33792.0mm^2

memory module: N/A
io module: N/A
Running mapping search...
find_simdram_mapping: Best mapping: Strategy(
  Loop Order: mkn  PE Enabled: True  Broadcast: 
  Array Multicast: False
  Column Popcount: False
  Tile Mapping:  M:   N: CRA  K: BDS  Array Mapping:  R: MN  C: K
  Weight Resident: True
  Input Resident: False
  Output Resident: False
)
Running simulation...
--- Input Matmul Size --- M:1, K:24576, N:24576
Maximum Array Tile Size: {'M': 1, 'K': 192, 'N': 12}
get_arr_tile_stats: arr_latency=1.3312e-05, capacity_utilization=0.000732421875
get_tile_stats: K_reduction_latency: 2.4e-07 = 3145728 / 13107200000000.0
 BDS ['C', 'R', 'A'] {'C': 1, 'R': 1, 'B': 1, 'A': 1, 'S': 1, 'D': 1}
24576 = 1 * 24576 * 1
get_tile_io_latency: data_volume=50331648, dup=[], simd_utilization={'C': 1, 'R': 1, 'B': 1, 'A': 1, 'S': 1, 'D': 1}
get_tile_io_latency: latency=3.84e-06 = 50331648 / 13107200000000.0
get_tile_stats: tile_size: {'M': 1, 'K': 24576, 'N': 24576}, arr_tile_size: {'M': 1, 'K': 192, 'N': 12}, MK_dup: 1, KN_dup:1, MN_dup:192, M_K_io_latency: 3.84e-06, K_N_io_latency: 0, M_N_io_latency: 3.5999999999999994e-07, tile_compute_latency:1.3552e-05 = 1.3312e-05(arr_latency) + 2.4e-07(K_reduction_latency)
================ Strategy Summary ================
Strategy(
  Loop Order: mkn  PE Enabled: True  Broadcast: 
  Array Multicast: False
  Column Popcount: False
  Tile Mapping:  M:   N: CRA  K: BDS  Array Mapping:  R: MN  C: K
  Weight Resident: True
  Input Resident: False
  Output Resident: False
)

---------------- Tile Sizes ----------------------
| Tile_M      | Tile_N      | Tile_K      |
|-------------|-------------|-------------|
| 1           | 24576       | 24576       |

| Arr_Tile_M  | Arr_Tile_N  | Arr_Tile_K  |
|-------------|-------------|-------------|
| 1           | 12          | 192         |

--------------- Utilization ----------------------
| Row         | Col         | Array       | Bank        | Device      | Rank        | Channel     |
|-------------|-------------|-------------|-------------|-------------|-------------|-------------|
| 0.000732421875 | 0.75        | 1           | 1           | 1           | 1           | 1           |

------------------ Latency -----------------------
| Total Latency        | 1.8112e-05             cycles|
| Total Compute Latency | 1.3552e-05             cycles|
| Total Array Latency  | 1.3312e-05             cycles|
| Total Reduction Latency| 2.4e-07                cycles|
| IO Latency           | 4.5599999999999995e-06 cycles|

----------- Hardware Requirements ---------------
| col_multicast        | False                 |
| col_broadcast        | False                 |
| broadcast            | {'C': True, 'R': True, 'B': False, 'A': True, 'S': False, 'D': False}|
| reduction            | {'C': False, 'R': False, 'B': True, 'A': False, 'S': True, 'D': True}|
==================================================

---------------- Debug Info -----------------------
| Remaining Tiles       |                         |
|-----------------------|-------------------------|
| M_remain              | 0                      |
| N_remain              | 0                      |
| K_remain              | 0                      |

| Fully Partitioned #Tiles |                       |
|-------------------------|-----------------------|
| M_t                   | 1                      |
| N_t                   | 1                      |
| K_t                   | 1                      |

|------------------------|------------------------|
==================================================
Tiling utilization: {'C': 1, 'R': 1, 'B': 1, 'A': 1, 'S': 1, 'D': 1}
Column utilization: 0.75
Capacity utilization: 0.000732421875
GEMM 1x24576x24576 latency: 1.8112e-05s
simulated latency: GEMM_1x24576x24576 1.8112e-05
roofline_model_simdram: total_ops=1207959552, total_data_movement=49152, peak_flops=687590819672131.2, bandwidth=13107200000000.0
roofline_model_simdram: compute_bound_time=1.7567999999999996e-06, memory_bound_time=3.75e-09
GEMM roofline latency: 1.7567999999999996e-06ms
Results written to test_gemm_x16_base_config.json_1_24576_24576_simdram_ddr5_operandocality.csv
Running LLM tests...
Testing GPT-3 175B model prefill
Simulate Running on DRAM PIM
compute module:
simdram config: 8channels x 32ranks x 16banks x 16arrays x 1subarrays x 16384subarr_rows x 1024cols x 8devices, with_PE: True
simdram logical config: 8channels x 32ranks x 16banks x 8arrays x 1subarrays x 131072subarr_rows x 256cols x 8devices, with_PE: True
simdram bw: 13107.2GB/s
simdram internal bw: 4739326.553672316GB/s
simdram ops: 687.5908196721313Tops
memory capacity: 1024.0GB
peripheral area: 830.6070382046778mm^2
dram area: 33792.0mm^2

memory module: N/A
io module: N/A
LLM model: gpt3-175B
simulating qkv: Matmul M=1024, K=12288, N=12288
qkv latency: 0.00849024, compute latency: 0.00269184, io overhead: 0.00013824
simulating q_mul_k: Batched Matmul BS=96 M=1024, K=128, N=1024
Batched Matmul: M=1024, K=128, N=1024, BS=96
BatchedMatmul latency: 9.727999999999999e-06
q_mul_k latency: 9.727999999999999e-06, compute latency: 5.888e-06, io overhead: 3.84e-06
simulating a_mul_v: Batched Matmul BS=96 M=1024, K=1024, N=128
Batched Matmul: M=1024, K=1024, N=128, BS=96
BatchedMatmul latency: 8.128e-06
a_mul_v latency: 8.128e-06, compute latency: 5.2479999999999996e-06, io overhead: 2.8800000000000004e-06
simulating h_matmul0: Matmul M=1024, K=12288, N=12288
h_matmul0 latency: 0.0028300799999999996, compute latency: 0.00269184, io overhead: 0.00013824
simulating h1_matmul1: Matmul M=1024, K=12288, N=49152
h1_matmul1 latency: 0.011038503999999994, compute latency: 0.010543103999999985, io overhead: 0.000495399999999998
simulating h2_matmul2: Matmul M=1024, K=49152, N=12288
h2_matmul2 latency: 0.010673664, compute latency: 0.010397184, io overhead: 0.00027648
finish matmul simulation
matmul total overhead: 0
matmul total latency w/o overhead: 0.033050343999999995
matmul total latency: 0.033050343999999995
weighted avg simd utilization: 0.9997298666543378
weighted avg tiling utilization: {'C': 1.0, 'R': 1.0, 'B': 1.0, 'A': 1.0, 'S': 1.0, 'D': 1.0}
gpt3-175B 96 layers prefill latency: 3.1728330239999996
simulated latency: gpt3-175B_prefill 3.1728330239999996
Testing GPT-3 175B model decode
Simulate Running on DRAM PIM
compute module:
simdram config: 8channels x 32ranks x 16banks x 16arrays x 1subarrays x 16384subarr_rows x 1024cols x 8devices, with_PE: True
simdram logical config: 8channels x 32ranks x 16banks x 8arrays x 1subarrays x 131072subarr_rows x 256cols x 8devices, with_PE: True
simdram bw: 13107.2GB/s
simdram internal bw: 4739326.553672316GB/s
simdram ops: 687.5908196721313Tops
memory capacity: 1024.0GB
peripheral area: 830.6070382046778mm^2
dram area: 33792.0mm^2

memory module: N/A
io module: N/A
simulating qkv: Matmul M=1, K=12288, N=12288
qkv latency: 2.334e-05, compute latency: 1.074e-05, io overhead: 1.2599999999999998e-05, kernel launch overhead: 0
simulating q_mul_k:BatchedMatmul BS=96 M=1, K=128, N=1025
Batched Matmul: M=1, K=128, N=1025, BS=96
BatchedMatmul latency: 1.364317687988281e-06
q_mul_k latency: 1.364317687988281e-06, compute latency: 1.3490048828124999e-06, io overhead: 1.531280517578125e-08, kernel launch overhead: 0
simulating a_mul_v: BatchedMatmul BS=96 M=1, K=1025, N=128
Batched Matmul: M=1, K=1025, N=128, BS=96
BatchedMatmul latency: 1.3566074218749998e-06
a_mul_v latency: 1.3566074218749998e-06, compute latency: 1.3465e-06, io overhead: 1.0107421875e-08, kernel launch overhead: 0
simulating h_matmul0: Matmul M=1, K=12288, N=12288
h_matmul0 latency: 7.78e-06, compute latency: 3.58e-06, io overhead: 4.2e-06, kernel launch overhead: 0
simulating h1_matmul1: Matmul M=1, K=12288, N=49152
h1_matmul1 latency: 1.8832e-05, compute latency: 1.3552e-05, io overhead: 5.279999999999999e-06, kernel launch overhead: 0
simulating h2_matmul2: Matmul M=1, K=49152, N=12288
h2_matmul2 latency: 1.7752e-05, compute latency: 1.3552e-05, io overhead: 4.2e-06, kernel launch overhead: 0
finish matmul simulation
matmul total overhead: 0
matmul total latency w/o overhead: 7.042492510986328e-05
matmul total latency: 7.042492510986328e-05
weighted avg simd utilization: 0.7215507136340432
weighted avg tiling utilization: {'C': 1.0, 'R': 1.0, 'B': 1.0, 'A': 0.9710368162131332, 'S': 1.0, 'D': 1.0}
transformer latency: 7.042492510986328e-05
gpt3-175B decode latency per token: 7.042492510986328e-05
gpt3-175B decode total latency for 2048 tokens: 13.846103676
simulated latency: gpt3-175B_decode 13.846103676
Testing GPT-3 6.7B model prefill
Simulate Running on DRAM PIM
compute module:
simdram config: 8channels x 32ranks x 16banks x 16arrays x 1subarrays x 16384subarr_rows x 1024cols x 8devices, with_PE: True
simdram logical config: 8channels x 32ranks x 16banks x 8arrays x 1subarrays x 131072subarr_rows x 256cols x 8devices, with_PE: True
simdram bw: 13107.2GB/s
simdram internal bw: 4739326.553672316GB/s
simdram ops: 687.5908196721313Tops
memory capacity: 1024.0GB
peripheral area: 830.6070382046778mm^2
dram area: 33792.0mm^2

memory module: N/A
io module: N/A
LLM model: gpt3-6.7B
simulating qkv: Matmul M=1024, K=4096, N=4096
qkv latency: 0.001036032, compute latency: 0.00029926400000000004, io overhead: 4.608e-05
simulating q_mul_k: Batched Matmul BS=32 M=1024, K=128, N=1024
Batched Matmul: M=1024, K=128, N=1024, BS=32
BatchedMatmul latency: 9.727999999999999e-06
q_mul_k latency: 9.727999999999999e-06, compute latency: 5.888e-06, io overhead: 3.84e-06
simulating a_mul_v: Batched Matmul BS=32 M=1024, K=1024, N=128
Batched Matmul: M=1024, K=1024, N=128, BS=32
BatchedMatmul latency: 8.128e-06
a_mul_v latency: 8.128e-06, compute latency: 5.2479999999999996e-06, io overhead: 2.8800000000000004e-06
simulating h_matmul0: Matmul M=1024, K=4096, N=4096
h_matmul0 latency: 0.00034534400000000003, compute latency: 0.00029926400000000004, io overhead: 4.608e-05
simulating h1_matmul1: Matmul M=1024, K=4096, N=16384
h1_matmul1 latency: 0.0013652480000000001, compute latency: 0.001196288, io overhead: 0.00016896
simulating h2_matmul2: Matmul M=1024, K=16384, N=4096
h2_matmul2 latency: 0.001247744, compute latency: 0.0011965440000000001, io overhead: 5.12e-05
finish matmul simulation
matmul total overhead: 0
matmul total latency w/o overhead: 0.004012224000000001
matmul total latency: 0.004012224000000001
weighted avg simd utilization: 0.9977748002105565
weighted avg tiling utilization: {'C': 1.0, 'R': 1.0, 'B': 1.0, 'A': 1.0, 'S': 1.0, 'D': 1.0}
gpt3-6.7B 32 layers prefill latency: 0.12839116800000003
simulated latency: gpt3-6.7B_prefill 0.12839116800000003
Testing GPT-3 6.7B model decode
Simulate Running on DRAM PIM
compute module:
simdram config: 8channels x 32ranks x 16banks x 16arrays x 1subarrays x 16384subarr_rows x 1024cols x 8devices, with_PE: True
simdram logical config: 8channels x 32ranks x 16banks x 8arrays x 1subarrays x 131072subarr_rows x 256cols x 8devices, with_PE: True
simdram bw: 13107.2GB/s
simdram internal bw: 4739326.553672316GB/s
simdram ops: 687.5908196721313Tops
memory capacity: 1024.0GB
peripheral area: 830.6070382046778mm^2
dram area: 33792.0mm^2

memory module: N/A
io module: N/A
simulating qkv: Matmul M=1, K=4096, N=4096
qkv latency: 8.052e-06, compute latency: 4.092e-06, io overhead: 3.96e-06, kernel launch overhead: 0
simulating q_mul_k:BatchedMatmul BS=32 M=1, K=128, N=1025
Batched Matmul: M=1, K=128, N=1025, BS=32
BatchedMatmul latency: 1.364317687988281e-06
q_mul_k latency: 1.364317687988281e-06, compute latency: 1.3490048828124999e-06, io overhead: 1.531280517578125e-08, kernel launch overhead: 0
simulating a_mul_v: BatchedMatmul BS=32 M=1, K=1025, N=128
Batched Matmul: M=1, K=1025, N=128, BS=32
BatchedMatmul latency: 1.3566074218749998e-06
a_mul_v latency: 1.3566074218749998e-06, compute latency: 1.3465e-06, io overhead: 1.0107421875e-08, kernel launch overhead: 0
simulating h_matmul0: Matmul M=1, K=4096, N=4096
h_matmul0 latency: 2.684e-06, compute latency: 1.364e-06, io overhead: 1.32e-06, kernel launch overhead: 0
simulating h1_matmul1: Matmul M=1, K=4096, N=16384
h1_matmul1 latency: 5.352000000000001e-06, compute latency: 2.4720000000000002e-06, io overhead: 2.8800000000000004e-06, kernel launch overhead: 0
simulating h2_matmul2: Matmul M=1, K=16384, N=4096
h2_matmul2 latency: 5.112e-06, compute latency: 2.4720000000000002e-06, io overhead: 2.64e-06, kernel launch overhead: 0
finish matmul simulation
matmul total overhead: 0
matmul total latency w/o overhead: 2.3920925109863282e-05
matmul total latency: 2.3920925109863282e-05
weighted avg simd utilization: 0.3324768977001894
weighted avg tiling utilization: {'C': 1.0, 'R': 1.0, 'B': 1.0, 'A': 0.9147303024542198, 'S': 1.0, 'D': 1.0}
transformer latency: 2.3920925109863282e-05
gpt3-6.7B decode latency per token: 2.3920925109863282e-05
gpt3-6.7B decode total latency for 2048 tokens: 1.567681748
simulated latency: gpt3-6.7B_decode 1.567681748
Testing LLaMA 3.1 70B model prefill
Simulate Running on DRAM PIM
compute module:
simdram config: 8channels x 32ranks x 16banks x 16arrays x 1subarrays x 16384subarr_rows x 1024cols x 8devices, with_PE: True
simdram logical config: 8channels x 32ranks x 16banks x 8arrays x 1subarrays x 131072subarr_rows x 256cols x 8devices, with_PE: True
simdram bw: 13107.2GB/s
simdram internal bw: 4739326.553672316GB/s
simdram ops: 687.5908196721313Tops
memory capacity: 1024.0GB
peripheral area: 830.6070382046778mm^2
dram area: 33792.0mm^2

memory module: N/A
io module: N/A
LLM model: Llama-3.1-70B
simulating q_proj: Matmul M=1024, K=8192, N=8192
q_proj latency: 0.001283328, compute latency: 0.001196288, io overhead: 8.704000000000001e-05
simulating k_proj: Matmul M=1024, K=8192, N=1024
k_proj latency: 0.00016512000000000002, compute latency: 0.00014976, io overhead: 1.5360000000000002e-05
simulating v_proj: Matmul M=1024, K=8192, N=1024
skipping v_proj simulation, using k_proj
v_proj latency: 0.00016512000000000002, compute latency: 0.00014976, io overhead: 1.5360000000000002e-05
simulating q_mul_k: Batched_Matmul BS=64 M=1024, K=128, N=1024
Batched Matmul: M=1024, K=128, N=1024, BS=64
BatchedMatmul latency: 9.727999999999999e-06
q_mul_k latency: 9.727999999999999e-06, compute latency: 5.888e-06, io overhead: 3.84e-06
simulating a_mul_v: Batched_Matmul BS=64 M=1024, K=1024, N=128
Batched Matmul: M=1024, K=1024, N=128, BS=64
BatchedMatmul latency: 8.128e-06
a_mul_v latency: 8.128e-06, compute latency: 5.2479999999999996e-06, io overhead: 2.8800000000000004e-06
simulating h_matmul0: Matmul M=1024, K=8192, N=8192
h_matmul0 latency: 0.001283328, compute latency: 0.001196288, io overhead: 8.704000000000001e-05
simulating h1_matmul1: Matmul M=1024, K=8192, N=28672
h1_matmul1 latency: 0.004478208000000001, compute latency: 0.004186368, io overhead: 0.00029184
simulating h2_matmul2: Matmul M=1024, K=28672, N=8192
h2_matmul2 latency: 0.0042442240000000004, compute latency: 0.004044544000000001, io overhead: 0.00019968000000000004
finish matmul simulation
matmul total overhead: 0
matmul total latency w/o overhead: 0.011637184000000002
matmul total latency: 0.011637184000000002
weighted avg simd utilization: 0.9992328040873117
weighted avg tiling utilization: {'C': 1.0, 'R': 1.0, 'B': 1.0, 'A': 1.0, 'S': 1.0, 'D': 1.0}
Llama-3.1-70B 80 layers prefill latency: 0.9309747200000001
simulated latency: Llama-3.1-70B_prefill 0.9309747200000001
Testing LLaMA 3.1 70B model decode
Simulate Running on DRAM PIM
compute module:
simdram config: 8channels x 32ranks x 16banks x 16arrays x 1subarrays x 16384subarr_rows x 1024cols x 8devices, with_PE: True
simdram logical config: 8channels x 32ranks x 16banks x 8arrays x 1subarrays x 131072subarr_rows x 256cols x 8devices, with_PE: True
simdram bw: 13107.2GB/s
simdram internal bw: 4739326.553672316GB/s
simdram ops: 687.5908196721313Tops
memory capacity: 1024.0GB
peripheral area: 830.6070382046778mm^2
dram area: 33792.0mm^2

memory module: N/A
io module: N/A
simulating q_proj: Matmul M=1, K=8192, N=8192
q_proj latency: 5.1920000000000004e-06, compute latency: 2.4720000000000002e-06, io overhead: 2.7200000000000002e-06
simulating k_proj: Matmul M=1, K=8192, N=1024
k_proj latency: 2.0039999999999998e-06, compute latency: 1.3539999999999999e-06, io overhead: 6.499999999999999e-07
simulating v_proj: Matmul M=1, K=8192, N=1024
skipping v_proj simulation, using k_proj
v_proj latency: 2.0039999999999998e-06, compute latency: 1.3539999999999999e-06, io overhead: 6.499999999999999e-07
simulating q_mul_k: Batched_Matmul BS=64 M=1, K=128, N=1025
Batched Matmul: M=1, K=128, N=1025, BS=64
BatchedMatmul latency: 1.364317687988281e-06
q_mul_k latency: 1.364317687988281e-06, compute latency: 1.3490048828124999e-06, io overhead: 1.531280517578125e-08
simulating a_mul_v: Batched_Matmul BS=64 M=1, K=1025, N=128
Batched Matmul: M=1, K=1025, N=128, BS=64
BatchedMatmul latency: 1.3566074218749998e-06
a_mul_v latency: 1.3566074218749998e-06, compute latency: 1.3465e-06, io overhead: 1.0107421875e-08
simulating h_matmul0: Matmul M=1, K=8192, N=8192
h_matmul0 latency: 5.1920000000000004e-06, compute latency: 2.4720000000000002e-06, io overhead: 2.7200000000000002e-06
simulating h1_matmul1: Matmul M=1, K=8192, N=28672
h1_matmul1 latency: 1.0918e-05, compute latency: 4.678e-06, io overhead: 6.2399999999999995e-06
simulating h2_matmul2: Matmul M=1, K=28672, N=8192
h2_matmul2 latency: 9.448000000000002e-06, compute latency: 4.688e-06, io overhead: 4.760000000000001e-06
finish matmul simulation
matmul total overhead: 0
matmul total latency w/o overhead: 3.747892510986328e-05
matmul total latency: 3.747892510986328e-05
weighted avg simd utilization: 0.6781452481932884
weighted avg tiling utilization: {'C': 1.0, 'R': 1.0, 'B': 1.0, 'A': 0.8921065628942192, 'S': 1.0, 'D': 1.0}
Llama-3.1-70B decode latency per token: 3.747892510986328e-05
Llama-3.1-70B decode total latency for 2048 tokens: 6.14054709
simulated latency: Llama-3.1-70B_decode 6.14054709
Testing LLaMA 3.1 8B model prefill
Simulate Running on DRAM PIM
compute module:
simdram config: 8channels x 32ranks x 16banks x 16arrays x 1subarrays x 16384subarr_rows x 1024cols x 8devices, with_PE: True
simdram logical config: 8channels x 32ranks x 16banks x 8arrays x 1subarrays x 131072subarr_rows x 256cols x 8devices, with_PE: True
simdram bw: 13107.2GB/s
simdram internal bw: 4739326.553672316GB/s
simdram ops: 687.5908196721313Tops
memory capacity: 1024.0GB
peripheral area: 830.6070382046778mm^2
dram area: 33792.0mm^2

memory module: N/A
io module: N/A
LLM model: Llama-3.1-8B
simulating q_proj: Matmul M=1024, K=4096, N=4096
q_proj latency: 0.00034534400000000003, compute latency: 0.00029926400000000004, io overhead: 4.608e-05
simulating k_proj: Matmul M=1024, K=4096, N=1024
k_proj latency: 9.036800000000001e-05, compute latency: 7.500800000000001e-05, io overhead: 1.5360000000000002e-05
simulating v_proj: Matmul M=1024, K=4096, N=1024
skipping v_proj simulation, using k_proj
v_proj latency: 9.036800000000001e-05, compute latency: 7.500800000000001e-05, io overhead: 1.5360000000000002e-05
simulating q_mul_k: Batched_Matmul BS=32 M=1024, K=128, N=1024
Batched Matmul: M=1024, K=128, N=1024, BS=32
BatchedMatmul latency: 9.727999999999999e-06
q_mul_k latency: 9.727999999999999e-06, compute latency: 5.888e-06, io overhead: 3.84e-06
simulating a_mul_v: Batched_Matmul BS=32 M=1024, K=1024, N=128
Batched Matmul: M=1024, K=1024, N=128, BS=32
BatchedMatmul latency: 8.128e-06
a_mul_v latency: 8.128e-06, compute latency: 5.2479999999999996e-06, io overhead: 2.8800000000000004e-06
simulating h_matmul0: Matmul M=1024, K=4096, N=4096
h_matmul0 latency: 0.00034534400000000003, compute latency: 0.00029926400000000004, io overhead: 4.608e-05
simulating h1_matmul1: Matmul M=1024, K=4096, N=14336
h1_matmul1 latency: 0.001195264, compute latency: 0.001046784, io overhead: 0.00014848000000000001
simulating h2_matmul2: Matmul M=1024, K=14336, N=4096
h2_matmul2 latency: 0.00113024, compute latency: 0.00101248, io overhead: 0.00011776000000000001
finish matmul simulation
matmul total overhead: 0
matmul total latency w/o overhead: 0.003214784
matmul total latency: 0.003214784
weighted avg simd utilization: 0.9972228305229838
weighted avg tiling utilization: {'C': 1.0, 'R': 1.0, 'B': 1.0, 'A': 1.0, 'S': 1.0, 'D': 1.0}
Llama-3.1-8B 32 layers prefill latency: 0.102873088
simulated latency: Llama-3.1-8B_prefill 0.102873088
Testing LLaMA 3.1 8B model decode
Simulate Running on DRAM PIM
compute module:
simdram config: 8channels x 32ranks x 16banks x 16arrays x 1subarrays x 16384subarr_rows x 1024cols x 8devices, with_PE: True
simdram logical config: 8channels x 32ranks x 16banks x 8arrays x 1subarrays x 131072subarr_rows x 256cols x 8devices, with_PE: True
simdram bw: 13107.2GB/s
simdram internal bw: 4739326.553672316GB/s
simdram ops: 687.5908196721313Tops
memory capacity: 1024.0GB
peripheral area: 830.6070382046778mm^2
dram area: 33792.0mm^2

memory module: N/A
io module: N/A
simulating q_proj: Matmul M=1, K=4096, N=4096
q_proj latency: 2.684e-06, compute latency: 1.364e-06, io overhead: 1.32e-06
simulating k_proj: Matmul M=1, K=4096, N=1024
k_proj latency: 1.679e-06, compute latency: 1.3539999999999999e-06, io overhead: 3.2499999999999996e-07
simulating v_proj: Matmul M=1, K=4096, N=1024
skipping v_proj simulation, using k_proj
v_proj latency: 1.679e-06, compute latency: 1.3539999999999999e-06, io overhead: 3.2499999999999996e-07
simulating q_mul_k: Batched_Matmul BS=32 M=1, K=128, N=1025
Batched Matmul: M=1, K=128, N=1025, BS=32
BatchedMatmul latency: 1.364317687988281e-06
q_mul_k latency: 1.364317687988281e-06, compute latency: 1.3490048828124999e-06, io overhead: 1.531280517578125e-08
simulating a_mul_v: Batched_Matmul BS=32 M=1, K=1025, N=128
Batched Matmul: M=1, K=1025, N=128, BS=32
BatchedMatmul latency: 1.3566074218749998e-06
a_mul_v latency: 1.3566074218749998e-06, compute latency: 1.3465e-06, io overhead: 1.0107421875e-08
simulating h_matmul0: Matmul M=1, K=4096, N=4096
h_matmul0 latency: 2.684e-06, compute latency: 1.364e-06, io overhead: 1.32e-06
simulating h1_matmul1: Matmul M=1, K=4096, N=14336
h1_matmul1 latency: 5.307e-06, compute latency: 2.4670000000000003e-06, io overhead: 2.84e-06
simulating h2_matmul2: Matmul M=1, K=14336, N=4096
h2_matmul2 latency: 4.782000000000001e-06, compute latency: 2.4720000000000002e-06, io overhead: 2.3100000000000003e-06
finish matmul simulation
matmul total overhead: 0
matmul total latency w/o overhead: 2.1535925109863284e-05
matmul total latency: 2.1535925109863284e-05
weighted avg simd utilization: 0.3038889640105854
weighted avg tiling utilization: {'C': 1.0, 'R': 1.0, 'B': 1.0, 'A': 0.8273243415287438, 'S': 1.0, 'D': 1.0}
Llama-3.1-8B decode latency per token: 2.1535925109863284e-05
Llama-3.1-8B decode total latency for 2048 tokens: 1.4113783880000002
simulated latency: Llama-3.1-8B_decode 1.4113783880000002
/home/siyuan/LLMCompass/exp_scripts/ablation_accumulative
